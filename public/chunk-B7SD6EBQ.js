import{Ea as Je,S as ol,V as al,W as Wt,Y as Kt,_ as zr,a as nl,aa as me,b as rl,e as Ye,ea as Ht,f as h,gb as ul,hb as ll,i as Nn,n as il,o as sl,pa as Qt,q as Ms,r as Fs,s as Us,wa as cl,y as Bs}from"./chunk-G4DX45GQ.js";var dl=function(t){let e=[],n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Hp=function(t){let e=[],n=0,r=0;for(;n<t.length;){let i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=t[n++],o=t[n++],a=t[n++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{let s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},fl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){let s=t[i],o=i+1<t.length,a=o?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,l=s>>2,d=(s&3)<<4|a>>4,f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),r.push(n[l],n[d],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(dl(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Hp(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();let n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){let s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;let u=i<t.length?n[t.charAt(i)]:64;++i;let d=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||d==null)throw new $s;let f=s<<2|a>>4;if(r.push(f),u!==64){let m=a<<4&240|u>>2;if(r.push(m),d!==64){let w=u<<6&192|d;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},$s=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Qp=function(t){let e=dl(t);return fl.encodeByteArray(e,!0)},On=function(t){return Qp(t).replace(/\./g,"")},js=function(t){try{return fl.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Yp(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Jp=()=>Yp().__FIREBASE_DEFAULTS__,Xp=()=>{if(typeof process>"u"||typeof process.env>"u")return;let t=process.env.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Zp=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=t&&js(t[1]);return e&&JSON.parse(e)},Gr=()=>{try{return Jp()||Xp()||Zp()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Gs=t=>{var e,n;return(n=(e=Gr())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},pl=t=>{let e=Gs(t);if(!e)return;let n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Ws=()=>{var t;return(t=Gr())===null||t===void 0?void 0:t.config},Ks=t=>{var e;return(e=Gr())===null||e===void 0?void 0:e[`_${t}`]};var jr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}};function ml(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[On(JSON.stringify(n)),On(JSON.stringify(o)),""].join(".")}function U(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(U())}function em(){var t;let e=(t=Gr())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _l(){let t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function yl(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Il(){let t=U();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function vl(){return!em()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Wr(){try{return typeof indexedDB=="object"}catch{return!1}}function El(){return new Promise((t,e)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}var tm="FirebaseError",he=class t extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=tm,Object.setPrototypeOf(this,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Be.prototype.create)}},Be=class{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){let r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?nm(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new he(i,a,r)}};function nm(t,e){return t.replace(rm,(n,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var rm=/\{\$([^}]+)}/g;function wl(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function mt(t,e){if(t===e)return!0;let n=Object.keys(t),r=Object.keys(e);for(let i of n){if(!r.includes(i))return!1;let s=t[i],o=e[i];if(hl(s)&&hl(o)){if(!mt(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!n.includes(i))return!1;return!0}function hl(t){return t!==null&&typeof t=="object"}function xn(t){let e=[];for(let[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Yt(t){let e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Jt(t){let e=t.indexOf("?");if(!e)return"";let n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Tl(t,e){let n=new zs(t,e);return n.subscribe.bind(n)}var zs=class{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");im(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=qs),i.error===void 0&&(i.error=qs),i.complete===void 0&&(i.complete=qs);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function im(t,e){if(typeof t!="object"||t===null)return!1;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function qs(){}var GE=4*60*60*1e3;function j(t){return t&&t._delegate?t._delegate:t}var ge=class{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var gt="[DEFAULT]";var Hs=class{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){let r=new jr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(n=e?.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(om(e))try{this.getOrInitializeService({instanceIdentifier:gt})}catch{}for(let[n,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(n);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=gt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return h(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=gt){return this.instances.has(e)}getOptions(e=gt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;let i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){let r=this.onInitCallbacks.get(n);if(r)for(let i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sm(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=gt){return this.component?this.component.multipleInstances?e:gt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function sm(t){return t===gt?void 0:t}function om(t){return t.instantiationMode==="EAGER"}var Kr=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let n=new Hs(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}};var am=[],C=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}(C||{}),cm={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},um=C.INFO,lm={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},hm=(t,e,...n)=>{if(e<t.logLevel)return;let r=new Date().toISOString(),i=lm[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Xe=class{constructor(e){this.name=e,this._logLevel=um,this._logHandler=hm,this._userLogHandler=null,am.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in C))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...e),this._logHandler(this,C.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...e),this._logHandler(this,C.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,C.INFO,...e),this._logHandler(this,C.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,C.WARN,...e),this._logHandler(this,C.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...e),this._logHandler(this,C.ERROR,...e)}};var dm=(t,e)=>e.some(n=>t instanceof n),Al,Sl;function fm(){return Al||(Al=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function pm(){return Sl||(Sl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var bl=new WeakMap,Ys=new WeakMap,Rl=new WeakMap,Qs=new WeakMap,Xs=new WeakMap;function mm(t){let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Se(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&bl.set(n,t)}).catch(()=>{}),Xs.set(e,t),e}function gm(t){if(Ys.has(t))return;let e=new Promise((n,r)=>{let i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});Ys.set(t,e)}var Js={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Ys.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Rl.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Se(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Pl(t){Js=t(Js)}function _m(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let r=t.call(Hr(this),e,...n);return Rl.set(r,e.sort?e.sort():[e]),Se(r)}:pm().includes(t)?function(...e){return t.apply(Hr(this),e),Se(bl.get(this))}:function(...e){return Se(t.apply(Hr(this),e))}}function ym(t){return typeof t=="function"?_m(t):(t instanceof IDBTransaction&&gm(t),dm(t,fm())?new Proxy(t,Js):t)}function Se(t){if(t instanceof IDBRequest)return mm(t);if(Qs.has(t))return Qs.get(t);let e=ym(t);return e!==t&&(Qs.set(t,e),Xs.set(e,t)),e}var Hr=t=>Xs.get(t);function Dl(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(t,e),a=Se(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Se(o.result),c.oldVersion,c.newVersion,Se(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var Im=["get","getKey","getAll","getAllKeys","count"],vm=["put","add","delete","clear"],Zs=new Map;function Cl(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Zs.get(e))return Zs.get(e);let n=e.replace(/FromIndex$/,""),r=e!==n,i=vm.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Im.includes(n)))return;let s=function(o,...a){return h(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),u=c.store;return r&&(u=u.index(a.shift())),(yield Promise.all([u[n](...a),i&&c.done]))[0]})};return Zs.set(e,s),s}Pl(t=>rl(nl({},t),{get:(e,n,r)=>Cl(e,n)||t.get(e,n,r),has:(e,n)=>!!Cl(e,n)||t.has(e,n)}));var to=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Em(n)){let r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}};function Em(t){let e=t.getComponent();return e?.type==="VERSION"}var no="@firebase/app",kl="0.10.1";var _t=new Xe("@firebase/app"),wm="@firebase/app-compat",Tm="@firebase/analytics-compat",Am="@firebase/analytics",Sm="@firebase/app-check-compat",bm="@firebase/app-check",Rm="@firebase/auth",Pm="@firebase/auth-compat",Cm="@firebase/database",Dm="@firebase/database-compat",km="@firebase/functions",Nm="@firebase/functions-compat",Om="@firebase/installations",xm="@firebase/installations-compat",Vm="@firebase/messaging",Lm="@firebase/messaging-compat",Mm="@firebase/performance",Fm="@firebase/performance-compat",Um="@firebase/remote-config",Bm="@firebase/remote-config-compat",qm="@firebase/storage",$m="@firebase/storage-compat",zm="@firebase/firestore",jm="@firebase/firestore-compat",Gm="firebase",Wm="10.11.0";var ro="[DEFAULT]",Km={[no]:"fire-core",[wm]:"fire-core-compat",[Am]:"fire-analytics",[Tm]:"fire-analytics-compat",[bm]:"fire-app-check",[Sm]:"fire-app-check-compat",[Rm]:"fire-auth",[Pm]:"fire-auth-compat",[Cm]:"fire-rtdb",[Dm]:"fire-rtdb-compat",[km]:"fire-fn",[Nm]:"fire-fn-compat",[Om]:"fire-iid",[xm]:"fire-iid-compat",[Vm]:"fire-fcm",[Lm]:"fire-fcm-compat",[Mm]:"fire-perf",[Fm]:"fire-perf-compat",[Um]:"fire-rc",[Bm]:"fire-rc-compat",[qm]:"fire-gcs",[$m]:"fire-gcs-compat",[zm]:"fire-fst",[jm]:"fire-fst-compat","fire-js":"fire-js",[Gm]:"fire-js-all"};var Vn=new Map,Hm=new Map,io=new Map;function Nl(t,e){try{t.container.addComponent(e)}catch(n){_t.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function et(t){let e=t.name;if(io.has(e))return _t.debug(`There were multiple attempts to register component ${e}.`),!1;io.set(e,t);for(let n of Vn.values())Nl(n,t);for(let n of Hm.values())Nl(n,t);return!0}function Mn(t,e){let n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ie(t){return t.settings!==void 0}var Qm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ze=new Be("app","Firebase",Qm);var so=class{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ge("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ze.create("app-deleted",{appName:this._name})}};var tt=Wm;function co(t,e={}){let n=t;typeof e!="object"&&(e={name:e});let r=Object.assign({name:ro,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Ze.create("bad-app-name",{appName:String(i)});if(n||(n=Ws()),!n)throw Ze.create("no-options");let s=Vn.get(i);if(s){if(mt(n,s.options)&&mt(r,s.config))return s;throw Ze.create("duplicate-app",{appName:i})}let o=new Kr(i);for(let c of io.values())o.addComponent(c);let a=new so(n,r,o);return Vn.set(i,a),a}function Xt(t=ro){let e=Vn.get(t);if(!e&&t===ro&&Ws())return co();if(!e)throw Ze.create("no-app",{appName:t});return e}function Qr(){return Array.from(Vn.values())}function H(t,e,n){var r;let i=(r=Km[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_t.warn(a.join(" "));return}et(new ge(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var Ym="firebase-heartbeat-database",Jm=1,Ln="firebase-heartbeat-store",eo=null;function Ll(){return eo||(eo=Dl(Ym,Jm,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ln)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ze.create("idb-open",{originalErrorMessage:t.message})})),eo}function Xm(t){return h(this,null,function*(){try{let n=(yield Ll()).transaction(Ln),r=yield n.objectStore(Ln).get(Ml(t));return yield n.done,r}catch(e){if(e instanceof he)_t.warn(e.message);else{let n=Ze.create("idb-get",{originalErrorMessage:e?.message});_t.warn(n.message)}}})}function Ol(t,e){return h(this,null,function*(){try{let r=(yield Ll()).transaction(Ln,"readwrite");yield r.objectStore(Ln).put(e,Ml(t)),yield r.done}catch(n){if(n instanceof he)_t.warn(n.message);else{let r=Ze.create("idb-set",{originalErrorMessage:n?.message});_t.warn(r.message)}}})}function Ml(t){return`${t.name}!${t.options.appId}`}var Zm=1024,eg=30*24*60*60*1e3,oo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let n=this.container.getProvider("app").getImmediate();this._storage=new ao(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return h(this,null,function*(){var e,n;let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=xl();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=eg}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return h(this,null,function*(){var e;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let n=xl(),{heartbeatsToSend:r,unsentEntries:i}=tg(this._heartbeatsCache.heartbeats),s=On(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s})}};function xl(){return new Date().toISOString().substring(0,10)}function tg(t,e=Zm){let n=[],r=t.slice();for(let i of t){let s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Vl(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Vl(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var ao=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return h(this,null,function*(){return Wr()?El().then(()=>!0).catch(()=>!1):!1})}read(){return h(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield Xm(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return h(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Ol(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return h(this,null,function*(){var n;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Ol(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Vl(t){return On(JSON.stringify({version:2,heartbeats:t})).length}function ng(t){et(new ge("platform-logger",e=>new to(e),"PRIVATE")),et(new ge("heartbeat",e=>new oo(e),"PRIVATE")),H(no,kl,t),H(no,kl,"esm2017"),H("fire-js","")}ng("");var rg="firebase",ig="10.11.0";H(rg,ig,"app");var It=new ul("ANGULARFIRE2_VERSION");function Jr(t,e,n){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===n);if(s.length===1)return s[0]}return n.container.getProvider(t).getImmediate({optional:!0})}var Fn=(t,e)=>{let n=e?[e]:Qr(),r=[];return n.forEach(i=>{i.container.getProvider(t).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},en=class{constructor(){return Fn(sg)}},sg="app-check";function Zt(){}var Yr=class{zone;delegate;constructor(e,n=sl){this.zone=e,this.delegate=n}now(){return this.delegate.now()}schedule(e,n,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,n,r)}},uo=class{zone;task=null;constructor(e){this.zone=e}call(e,n){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Zt,{},Zt,Zt)),n.pipe(ol({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},tn=(()=>{class t{ngZone;outsideAngular;insideAngular;constructor(n){this.ngZone=n,this.outsideAngular=n.runOutsideAngular(()=>new Yr(Zone.current)),this.insideAngular=n.run(()=>new Yr(Zone.current,il)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||t)(zr(Je))};static \u0275prov=al({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Xr(){let t=globalThis.\u0275AngularFireScheduler;if(!t)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return t}function og(t){return Xr().ngZone.runOutsideAngular(()=>t())}function yt(t){return Xr().ngZone.run(()=>t())}function ag(t){return cg(Xr())(t)}function cg(t){return function(n){return n=n.lift(new uo(t.ngZone)),n.pipe(Us(t.outsideAngular),Fs(t.insideAngular))}}var ug=(t,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),yt(()=>t.apply(void 0,r))},Z=(t,e)=>function(){let n,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(n||=yt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Zt,{},Zt,Zt))),r[s]=ug(r[s],n));let i=og(()=>t.apply(this,r));if(!e)if(i instanceof Nn){let s=Xr();return i.pipe(Us(s.outsideAngular),Fs(s.insideAngular))}else return yt(()=>i);return i instanceof Nn?i.pipe(ag):i instanceof Promise?yt(()=>new Promise((s,o)=>i.then(a=>yt(()=>s(a)),a=>yt(()=>o(a))))):typeof i=="function"&&n?function(){return setTimeout(()=>{n&&n.state==="scheduled"&&n.invoke()},10),i.apply(this,arguments)}:yt(()=>i)};var qe=class{constructor(e){return e}},vt=class{constructor(){return Qr()}};function lg(t){return t&&t.length===1?t[0]:new qe(Xt())}var ho=new Kt("angularfire2._apps"),hg={provide:qe,useFactory:lg,deps:[[new me,ho]]},dg={provide:vt,deps:[[new me,ho]]};function fg(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new qe(r)}}var pg=(()=>{class t{constructor(n){H("angularfire",It.full,"core"),H("angularfire",It.full,"app"),H("angular",ll.full,n.toString())}static \u0275fac=function(r){return new(r||t)(zr(cl))};static \u0275mod=Ht({type:t});static \u0275inj=Wt({providers:[hg,dg]})}return t})();function Cw(t,...e){return{ngModule:pg,providers:[{provide:ho,useFactory:fg(t),multi:!0,deps:[Je,Qt,tn,...e]}]}}var Dw=Z(co,!0);function eh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var th=eh,nh=new Be("auth","Firebase",eh());var ii=new Xe("@firebase/auth");function mg(t,...e){ii.logLevel<=C.WARN&&ii.warn(`Auth (${tt}): ${t}`,...e)}function ei(t,...e){ii.logLevel<=C.ERROR&&ii.error(`Auth (${tt}): ${t}`,...e)}function Re(t,...e){throw Vo(t,...e)}function Et(t,...e){return Vo(t,...e)}function rh(t,e,n){let r=Object.assign(Object.assign({},th()),{[e]:n});return new Be("auth","Firebase",r).create(e,{appName:t.name})}function je(t){return rh(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Vo(t,...e){if(typeof t!="string"){let n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return nh.create(t,...e)}function A(t,e,...n){if(!t)throw Vo(e,...n)}function $e(t){let e="INTERNAL ASSERTION FAILED: "+t;throw ei(e),new Error(e)}function rt(t,e){t||$e(e)}function go(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function gg(){return Fl()==="http:"||Fl()==="https:"}function Fl(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}function _g(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gg()||_l()||"connection"in navigator)?navigator.onLine:!0}function yg(){if(typeof navigator>"u")return null;let t=navigator;return t.languages&&t.languages[0]||t.language||null}var wt=class{constructor(e,n){this.shortDelay=e,this.longDelay=n,rt(n>e,"Short delay should be less than long delay!"),this.isMobile=gl()||yl()}get(){return _g()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Lo(t,e){rt(t.emulator,"Emulator should always be set here");let{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}var si=class{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$e("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$e("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$e("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Ig={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var vg=new wt(3e4,6e4);function it(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}function st(s,o,a,c){return h(this,arguments,function*(t,e,n,r,i={}){return ih(t,i,()=>h(this,null,function*(){let u={},l={};r&&(e==="GET"?l=r:u={body:JSON.stringify(r)});let d=xn(Object.assign({key:t.config.apiKey},l)).slice(1),f=yield t._getAdditionalHeaders();return f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode),si.fetch()(sh(t,t.config.apiHost,n,d),Object.assign({method:e,headers:f,referrerPolicy:"no-referrer"},u))}))})}function ih(t,e,n){return h(this,null,function*(){t._canInitEmulator=!1;let r=Object.assign(Object.assign({},Ig),e);try{let i=new _o(t),s=yield Promise.race([n(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw Zr(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Zr(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Zr(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Zr(t,"user-disabled",o);let l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw rh(t,l,u);Re(t,l)}}catch(i){if(i instanceof he)throw i;Re(t,"network-request-failed",{message:String(i)})}})}function Wn(s,o,a,c){return h(this,arguments,function*(t,e,n,r,i={}){let u=yield st(t,e,n,r,i);return"mfaPendingCredential"in u&&Re(t,"multi-factor-auth-required",{_serverResponse:u}),u})}function sh(t,e,n,r){let i=`${e}${n}?${r}`;return t.config.emulator?Lo(t.config,i):`${t.config.apiScheme}://${i}`}function Eg(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var _o=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Et(this.auth,"network-request-failed")),vg.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function Zr(t,e,n){let r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=Et(t,e,r);return i.customData._tokenResponse=n,i}function Ul(t){return t!==void 0&&t.enterprise!==void 0}var yo=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return Eg(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function wg(t,e){return h(this,null,function*(){return st(t,"GET","/v2/recaptchaConfig",it(t,e))})}function Tg(t,e){return h(this,null,function*(){return st(t,"POST","/v1/accounts:delete",e)})}function oh(t,e){return h(this,null,function*(){return st(t,"POST","/v1/accounts:lookup",e)})}function Un(t){if(t)try{let e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Mo(t,e=!1){return h(this,null,function*(){let n=j(t),r=yield n.getIdToken(e),i=Fo(r);A(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:Un(fo(i.auth_time)),issuedAtTime:Un(fo(i.iat)),expirationTime:Un(fo(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function fo(t){return Number(t)*1e3}function Fo(t){let[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return ei("JWT malformed, contained fewer than 3 sections"),null;try{let i=js(n);return i?JSON.parse(i):(ei("Failed to decode base64 JWT payload"),null)}catch(i){return ei("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Bl(t){let e=Fo(t);return A(e,"internal-error"),A(typeof e.exp<"u","internal-error"),A(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function qn(t,e,n=!1){return h(this,null,function*(){if(n)return e;try{return yield e}catch(r){throw r instanceof he&&Ag(r)&&t.auth.currentUser===t&&(yield t.auth.signOut()),r}})}function Ag({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}var Io=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let n=this.getInterval(e);this.timerId=setTimeout(()=>h(this,null,function*(){yield this.iteration()}),n)}iteration(){return h(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var $n=class{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Un(this.lastLoginAt),this.creationTime=Un(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function oi(t){return h(this,null,function*(){var e;let n=t.auth,r=yield t.getIdToken(),i=yield qn(t,oh(n,{idToken:r}));A(i?.users.length,n,"internal-error");let s=i.users[0];t._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?ah(s.providerUserInfo):[],a=Sg(t.providerData,o),c=t.isAnonymous,u=!(t.email&&s.passwordHash)&&!a?.length,l=c?u:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new $n(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(t,d)})}function Uo(t){return h(this,null,function*(){let e=j(t);yield oi(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Sg(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function ah(t){return t.map(e=>{var{providerId:n}=e,r=Ms(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function bg(t,e){return h(this,null,function*(){let n=yield ih(t,{},()=>h(this,null,function*(){let r=xn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=sh(t,i,"/v1/token",`key=${s}`),a=yield t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",si.fetch()(o,{method:"POST",headers:a,body:r})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})}function Rg(t,e){return h(this,null,function*(){return st(t,"POST","/v2/accounts:revokeToken",it(t,e))})}var Bn=class t{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){A(e.idToken,"internal-error"),A(typeof e.idToken<"u","internal-error"),A(typeof e.refreshToken<"u","internal-error");let n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Bl(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){A(e.length!==0,"internal-error");let n=Bl(e);this.updateTokensAndExpiration(e,null,n)}getToken(e,n=!1){return h(this,null,function*(){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(A(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,n){return h(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield bg(e,n);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){let{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new t;return r&&(A(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(A(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(A(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new t,this.toJSON())}_performRefresh(){return $e("not implemented")}};function nt(t,e){A(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}var nn=class t{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=Ms(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Io(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new $n(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return h(this,null,function*(){let n=yield qn(this,this.stsTokenManager.getToken(this.auth,e));return A(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n})}getIdTokenResult(e){return Mo(this,e)}reload(){return Uo(this)}_assign(e){this!==e&&(A(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let n=new t(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){A(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,n=!1){return h(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&(yield oi(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return h(this,null,function*(){if(Ie(this.auth.app))return Promise.reject(je(this.auth));let e=yield this.getIdToken();return yield qn(this,Tg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,c,u,l;let d=(r=n.displayName)!==null&&r!==void 0?r:void 0,f=(i=n.email)!==null&&i!==void 0?i:void 0,m=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,w=(o=n.photoURL)!==null&&o!==void 0?o:void 0,T=(a=n.tenantId)!==null&&a!==void 0?a:void 0,v=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,N=(u=n.createdAt)!==null&&u!==void 0?u:void 0,M=(l=n.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:z,emailVerified:re,isAnonymous:Ae,providerData:Q,stsTokenManager:Ue}=n;A(z&&Ue,e,"internal-error");let Gt=Bn.fromJSON(this.name,Ue);A(typeof z=="string",e,"internal-error"),nt(d,e.name),nt(f,e.name),A(typeof re=="boolean",e,"internal-error"),A(typeof Ae=="boolean",e,"internal-error"),nt(m,e.name),nt(w,e.name),nt(T,e.name),nt(v,e.name),nt(N,e.name),nt(M,e.name);let kn=new t({uid:z,auth:e,email:f,emailVerified:re,displayName:d,isAnonymous:Ae,photoURL:w,phoneNumber:m,tenantId:T,stsTokenManager:Gt,createdAt:N,lastLoginAt:M});return Q&&Array.isArray(Q)&&(kn.providerData=Q.map($r=>Object.assign({},$r))),v&&(kn._redirectEventId=v),kn}static _fromIdTokenResponse(e,n,r=!1){return h(this,null,function*(){let i=new Bn;i.updateFromServerResponse(n);let s=new t({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield oi(s),s})}static _fromGetAccountInfoResponse(e,n,r){return h(this,null,function*(){let i=n.users[0];A(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?ah(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,a=new Bn;a.updateFromIdToken(r);let c=new t({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new $n(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(c,u),c})}};var ql=new Map;function ze(t){rt(t instanceof Function,"Expected a class definition");let e=ql.get(t);return e?(rt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ql.set(t,e),e)}var Pg=(()=>{class t{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return h(this,null,function*(){return!0})}_set(n,r){return h(this,null,function*(){this.storage[n]=r})}_get(n){return h(this,null,function*(){let r=this.storage[n];return r===void 0?null:r})}_remove(n){return h(this,null,function*(){delete this.storage[n]})}_addListener(n,r){}_removeListener(n,r){}}return t.type="NONE",t})(),vo=Pg;function ti(t,e,n){return`firebase:${t}:${e}:${n}`}var ai=class t{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=ti(this.userKey,i.apiKey,s),this.fullPersistenceKey=ti("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return h(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?nn._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return h(this,null,function*(){if(this.persistence===e)return;let n=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,n,r="authUser"){return h(this,null,function*(){if(!n.length)return new t(ze(vo),e,r);let i=(yield Promise.all(n.map(u=>h(this,null,function*(){if(yield u._isAvailable())return u})))).filter(u=>u),s=i[0]||ze(vo),o=ti(r,e.config.apiKey,e.name),a=null;for(let u of n)try{let l=yield u._get(o);if(l){let d=nn._fromJSON(e,l);u!==s&&(a=d),s=u;break}}catch{}let c=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new t(s,e,r):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(n.map(u=>h(this,null,function*(){if(u!==s)try{yield u._remove(o)}catch{}}))),new t(s,e,r))})}};function $l(t){let e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(lh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ch(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dh(e))return"Blackberry";if(fh(e))return"Webos";if(Bo(e))return"Safari";if((e.includes("chrome/")||uh(e))&&!e.includes("edge/"))return"Chrome";if(hh(e))return"Android";{let n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function ch(t=U()){return/firefox\//i.test(t)}function Bo(t=U()){let e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uh(t=U()){return/crios\//i.test(t)}function lh(t=U()){return/iemobile/i.test(t)}function hh(t=U()){return/android/i.test(t)}function dh(t=U()){return/blackberry/i.test(t)}function fh(t=U()){return/webos/i.test(t)}function mi(t=U()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Cg(t=U()){var e;return mi(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Dg(){return Il()&&document.documentMode===10}function ph(t=U()){return mi(t)||hh(t)||fh(t)||dh(t)||/windows phone/i.test(t)||lh(t)}function kg(){try{return!!(window&&window!==window.top)}catch{return!1}}function mh(t,e=[]){let n;switch(t){case"Browser":n=$l(U());break;case"Worker":n=`${$l(U())}-${t}`;break;default:n=t}let r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${tt}/${r}`}var Eo=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){let r=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return h(this,null,function*(){if(this.auth.currentUser===e)return;let n=[];try{for(let r of this.queue)yield r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(let i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Ng(n){return h(this,arguments,function*(t,e={}){return st(t,"GET","/v2/passwordPolicy",it(t,e))})}var Og=6,wo=class{constructor(e){var n,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:Og,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,n){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var To=class{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ci(this),this.idTokenSubscription=new ci(this),this.beforeStateQueue=new Eo(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ze(n)),this._initializationPromise=this.queue(()=>h(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield ai.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return h(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return h(this,null,function*(){try{let n=yield oh(this,{idToken:e}),r=yield nn._fromGetAccountInfoResponse(this,n,e);yield this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return h(this,null,function*(){var n;if(Ie(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return A(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return h(this,null,function*(){let n=null;try{n=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return n})}reloadAndSetCurrentUserOrClear(e){return h(this,null,function*(){try{yield oi(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=yg()}_delete(){return h(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return h(this,null,function*(){if(Ie(this.app))return Promise.reject(je(this));let n=e?j(e):null;return n&&A(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))})}_updateCurrentUser(e,n=!1){return h(this,null,function*(){if(!this._deleted)return e&&A(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>h(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return h(this,null,function*(){return Ie(this.app)?Promise.reject(je(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ie(this.app)?Promise.reject(je(this)):this.queue(()=>h(this,null,function*(){yield this.assertedPersistence.setPersistence(ze(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return h(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return h(this,null,function*(){let e=yield Ng(this),n=new wo(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Be("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},n)}})}revokeAccessToken(e){return h(this,null,function*(){if(this.currentUser){let n=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Rg(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,n){return h(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return h(this,null,function*(){if(!this.redirectPersistenceManager){let n=e&&ze(e)||this._popupRedirectResolver;A(n,this,"argument-error"),this.redirectPersistenceManager=yield ai.create(this,[ze(n._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return h(this,null,function*(){var n,r;return this._isInitialized&&(yield this.queue(()=>h(this,null,function*(){}))),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return h(this,null,function*(){if(e===this.currentUser)return this.queue(()=>h(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};let s=typeof n=="function"?n:n.next.bind(n),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(A(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){let c=e.addObserver(n,r,i);return()=>{o=!0,c()}}else{let c=e.addObserver(n);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return h(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return A(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return h(this,null,function*(){var e;let n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(n["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n})}_getAppCheckToken(){return h(this,null,function*(){var e;let n=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return n?.error&&mg(`Error while retrieving App Check token: ${n.error}`),n?.token})}};function At(t){return j(t)}var ci=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Tl(n=>this.observer=n)}get next(){return A(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var gi={loadJS(){return h(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function xg(t){gi=t}function gh(t){return gi.loadJS(t)}function Vg(){return gi.recaptchaEnterpriseScript}function Lg(){return gi.gapiScript}function _h(t){return`__${t}${Math.floor(Math.random()*1e6)}`}var Mg="recaptcha-enterprise",Fg="NO_RECAPTCHA",Ao=class{constructor(e){this.type=Mg,this.auth=At(e)}verify(e="verify",n=!1){return h(this,null,function*(){function r(s){return h(this,null,function*(){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,a)=>h(this,null,function*(){wg(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{let u=new yo(c);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})}))})}function i(s,o,a){let c=window.grecaptcha;Ul(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(u=>{o(u)}).catch(()=>{o(Fg)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(a=>{if(!n&&Ul(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Vg();c.length!==0&&(c+=a),gh(c).then(()=>{i(a,s,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})})}};function zl(t,e,n,r=!1){return h(this,null,function*(){let i=new Ao(t),s;try{s=yield i.verify(n)}catch{s=yield i.verify(n,!0)}let o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function So(t,e,n,r){return h(this,null,function*(){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield zl(t,e,n,n==="getOobCode");return r(t,s)}else return r(t,e).catch(s=>h(this,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=yield zl(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(s)}))})}function qo(t,e){let n=Mn(t,"auth");if(n.isInitialized()){let i=n.getImmediate(),s=n.getOptions();if(mt(s,e??{}))return i;Re(i,"already-initialized")}return n.initialize({options:e})}function Ug(t,e){let n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(ze);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function $o(t,e,n){let r=At(t);A(r._canInitEmulator,r,"emulator-config-failed"),A(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!n?.disableWarnings,s=yh(e),{host:o,port:a}=Bg(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||qg()}function yh(t){let e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Bg(t){let e=yh(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:jl(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:jl(o)}}}function jl(t){if(!t)return null;let e=Number(t);return isNaN(e)?null:e}function qg(){function t(){let e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}var zn=class{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return $e("not implemented")}_getIdTokenResponse(e){return $e("not implemented")}_linkToIdToken(e,n){return $e("not implemented")}_getReauthenticationResolver(e){return $e("not implemented")}};function $g(t,e){return h(this,null,function*(){return st(t,"POST","/v1/accounts:signUp",e)})}function zg(t,e){return h(this,null,function*(){return Wn(t,"POST","/v1/accounts:signInWithPassword",it(t,e))})}function jg(t,e){return h(this,null,function*(){return Wn(t,"POST","/v1/accounts:signInWithEmailLink",it(t,e))})}function Gg(t,e){return h(this,null,function*(){return Wn(t,"POST","/v1/accounts:signInWithEmailLink",it(t,e))})}var jn=class t extends zn{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new t(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new t(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}_getIdTokenResponse(e){return h(this,null,function*(){switch(this.signInMethod){case"password":let n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return So(e,n,"signInWithPassword",zg);case"emailLink":return jg(e,{email:this._email,oobCode:this._password});default:Re(e,"internal-error")}})}_linkToIdToken(e,n){return h(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return So(e,r,"signUpPassword",$g);case"emailLink":return Gg(e,{idToken:n,email:this._email,oobCode:this._password});default:Re(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function po(t,e){return h(this,null,function*(){return Wn(t,"POST","/v1/accounts:signInWithIdp",it(t,e))})}function Wg(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Kg(t){let e=Yt(Jt(t)).link,n=e?Yt(Jt(e)).deep_link_id:null,r=Yt(Jt(t)).deep_link_id;return(r?Yt(Jt(r)).link:null)||r||n||e||t}var ui=class t{constructor(e){var n,r,i,s,o,a;let c=Yt(Jt(e)),u=(n=c.apiKey)!==null&&n!==void 0?n:null,l=(r=c.oobCode)!==null&&r!==void 0?r:null,d=Wg((i=c.mode)!==null&&i!==void 0?i:null);A(u&&l&&d,"argument-error"),this.apiKey=u,this.operation=d,this.code=l,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){let n=Kg(e);try{return new t(n)}catch{return null}}};var Ih=(()=>{class t{constructor(){this.providerId=t.PROVIDER_ID}static credential(n,r){return jn._fromEmailAndPassword(n,r)}static credentialWithLink(n,r){let i=ui.parseLink(r);return A(i,"argument-error"),jn._fromEmailAndCode(n,i.code,i.tenantId)}}t.PROVIDER_ID="password",t.EMAIL_PASSWORD_SIGN_IN_METHOD="password",t.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return t})(),li=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var bo=class extends li{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function Hg(t,e){return h(this,null,function*(){return Wn(t,"POST","/v1/accounts:signUp",it(t,e))})}var rn=class t{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,n,r,i=!1){return h(this,null,function*(){let s=yield nn._fromIdTokenResponse(e,r,i),o=Gl(r);return new t({user:s,providerId:o,_tokenResponse:r,operationType:n})})}static _forOperation(e,n,r){return h(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Gl(r);return new t({user:e,providerId:i,_tokenResponse:r,operationType:n})})}};function Gl(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}var Ro=class t extends he{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,t.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new t(e,n,r,i)}};function vh(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Ro._fromErrorAndOperation(t,s,e,r):s})}function Qg(t,e,n=!1){return h(this,null,function*(){let r=yield qn(t,e._linkToIdToken(t.auth,yield t.getIdToken()),n);return rn._forOperation(t,"link",r)})}function Yg(t,e,n=!1){return h(this,null,function*(){let{auth:r}=t;if(Ie(r.app))return Promise.reject(je(r));let i="reauthenticate";try{let s=yield qn(t,vh(r,i,e,t),n);A(s.idToken,r,"internal-error");let o=Fo(s.idToken);A(o,r,"internal-error");let{sub:a}=o;return A(t.uid===a,r,"user-mismatch"),rn._forOperation(t,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Re(r,"user-mismatch"),s}})}function Eh(t,e,n=!1){return h(this,null,function*(){if(Ie(t.app))return Promise.reject(je(t));let r="signIn",i=yield vh(t,r,e),s=yield rn._fromIdTokenResponse(t,r,i);return n||(yield t._updateCurrentUser(s.user)),s})}function zo(t,e){return h(this,null,function*(){return Eh(At(t),e)})}function wh(t){return h(this,null,function*(){let e=At(t);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function jo(t,e,n){return h(this,null,function*(){if(Ie(t.app))return Promise.reject(je(t));let r=At(t),o=yield So(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Hg).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&wh(t),c}),a=yield rn._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(a.user),a})}function Go(t,e,n){return Ie(t.app)?Promise.reject(je(t)):zo(j(t),Ih.credential(e,n)).catch(r=>h(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&wh(t),r}))}function Wo(t,e,n,r){return j(t).onIdTokenChanged(e,n,r)}function Ko(t,e,n){return j(t).beforeAuthStateChanged(e,n)}function Ho(t){return j(t).signOut()}var hi="__sak";var di=class{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(hi,"1"),this.storage.removeItem(hi),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){let n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};function Jg(){let t=U();return Bo(t)||mi(t)}var Xg=1e3,Zg=10,e_=(()=>{class t extends di{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,r)=>this.onStorageEvent(n,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Jg()&&kg(),this.fallbackToPolling=ph(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&n(r,s,i)}}onStorageEvent(n,r=!1){if(!n.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}let i=n.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let a=this.storage.getItem(i);if(n.newValue!==a)n.newValue!==null?this.storage.setItem(i,n.newValue):this.storage.removeItem(i);else if(this.localCache[i]===n.newValue&&!r)return}let s=()=>{let a=this.storage.getItem(i);!r&&this.localCache[i]===a||this.notifyListeners(i,a)},o=this.storage.getItem(i);Dg()&&o!==n.newValue&&n.newValue!==n.oldValue?setTimeout(s,Zg):s()}notifyListeners(n,r){this.localCache[n]=r;let i=this.listeners[n];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:r,newValue:i}),!0)})},Xg)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(r)}_removeListener(n,r){this.listeners[n]&&(this.listeners[n].delete(r),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(n,r){return h(this,null,function*(){yield Ye(t.prototype,this,"_set").call(this,n,r),this.localCache[n]=JSON.stringify(r)})}_get(n){return h(this,null,function*(){let r=yield Ye(t.prototype,this,"_get").call(this,n);return this.localCache[n]=JSON.stringify(r),r})}_remove(n){return h(this,null,function*(){yield Ye(t.prototype,this,"_remove").call(this,n),delete this.localCache[n]})}}return t.type="LOCAL",t})(),Th=e_;var t_=(()=>{class t extends di{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,r){}_removeListener(n,r){}}return t.type="SESSION",t})(),Qo=t_;function n_(t){return Promise.all(t.map(e=>h(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(n){return{fulfilled:!1,reason:n}}})))}var r_=(()=>{class t{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){let r=this.receivers.find(s=>s.isListeningto(n));if(r)return r;let i=new t(n);return this.receivers.push(i),i}isListeningto(n){return this.eventTarget===n}handleEvent(n){return h(this,null,function*(){let r=n,{eventId:i,eventType:s,data:o}=r.data,a=this.handlersMap[s];if(!a?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let c=Array.from(a).map(l=>h(this,null,function*(){return l(r.origin,o)})),u=yield n_(c);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:u})})}_subscribe(n,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(r)}_unsubscribe(n,r){this.handlersMap[n]&&r&&this.handlersMap[n].delete(r),(!r||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}t.receivers=[];return t})();function Ah(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}var Po=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,n,r=50){return h(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{let u=Ah("",20);i.port1.start();let l=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(d){let f=d;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(f.data.response);break;default:clearTimeout(l),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function be(){return window}function i_(t){be().location.href=t}function Sh(){return typeof be().WorkerGlobalScope<"u"&&typeof be().importScripts=="function"}function s_(){return h(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function o_(){var t;return((t=navigator?.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function a_(){return Sh()?self:null}var bh="firebaseLocalStorageDb",c_=1,fi="firebaseLocalStorage",Rh="fbase_key",Tt=class{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}};function _i(t,e){return t.transaction([fi],e?"readwrite":"readonly").objectStore(fi)}function u_(){let t=indexedDB.deleteDatabase(bh);return new Tt(t).toPromise()}function Co(){let t=indexedDB.open(bh,c_);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{let r=t.result;try{r.createObjectStore(fi,{keyPath:Rh})}catch(i){n(i)}}),t.addEventListener("success",()=>h(this,null,function*(){let r=t.result;r.objectStoreNames.contains(fi)?e(r):(r.close(),yield u_(),e(yield Co()))}))})}function Wl(t,e,n){return h(this,null,function*(){let r=_i(t,!0).put({[Rh]:e,value:n});return new Tt(r).toPromise()})}function l_(t,e){return h(this,null,function*(){let n=_i(t,!1).get(e),r=yield new Tt(n).toPromise();return r===void 0?null:r.value})}function Kl(t,e){let n=_i(t,!0).delete(e);return new Tt(n).toPromise()}var h_=800,d_=3,f_=(()=>{class t{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return h(this,null,function*(){return this.db?this.db:(this.db=yield Co(),this.db)})}_withRetries(n){return h(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield n(i)}catch(i){if(r++>d_)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return h(this,null,function*(){return Sh()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return h(this,null,function*(){this.receiver=r_._getInstance(a_()),this.receiver._subscribe("keyChanged",(n,r)=>h(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(n,r)=>h(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return h(this,null,function*(){var n,r;if(this.activeServiceWorker=yield s_(),!this.activeServiceWorker)return;this.sender=new Po(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((n=i[0])===null||n===void 0)&&n.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(n){return h(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||o_()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return h(this,null,function*(){try{if(!indexedDB)return!1;let n=yield Co();return yield Wl(n,hi,"1"),yield Kl(n,hi),!0}catch{}return!1})}_withPendingWrite(n){return h(this,null,function*(){this.pendingWrites++;try{yield n()}finally{this.pendingWrites--}})}_set(n,r){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(i=>Wl(i,n,r)),this.localCache[n]=r,this.notifyServiceWorker(n)}))})}_get(n){return h(this,null,function*(){let r=yield this._withRetries(i=>l_(i,n));return this.localCache[n]=r,r})}_remove(n){return h(this,null,function*(){return this._withPendingWrite(()=>h(this,null,function*(){return yield this._withRetries(r=>Kl(r,n)),delete this.localCache[n],this.notifyServiceWorker(n)}))})}_poll(){return h(this,null,function*(){let n=yield this._withRetries(s=>{let o=_i(s,!1).getAll();return new Tt(o).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(n.length!==0)for(let{fbase_key:s,value:o}of n)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(n,r){this.localCache[n]=r;let i=this.listeners[n];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>h(this,null,function*(){return this._poll()}),h_)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(r)}_removeListener(n,r){this.listeners[n]&&(this.listeners[n].delete(r),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return t.type="LOCAL",t})(),Ph=f_;var Fw=_h("rcb"),Uw=new wt(3e4,6e4);function p_(t,e){return e?ze(e):(A(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}var Gn=class extends zn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return po(e,this._buildIdpRequest())}_linkToIdToken(e,n){return po(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return po(e,this._buildIdpRequest())}_buildIdpRequest(e){let n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}};function m_(t){return Eh(t.auth,new Gn(t),t.bypassAuthState)}function g_(t){let{auth:e,user:n}=t;return A(n,e,"internal-error"),Yg(n,new Gn(t),t.bypassAuthState)}function __(t){return h(this,null,function*(){let{auth:e,user:n}=t;return A(n,e,"internal-error"),Qg(n,new Gn(t),t.bypassAuthState)})}var Do=class{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise((e,n)=>h(this,null,function*(){this.pendingPromise={resolve:e,reject:n};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return h(this,null,function*(){let{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}let c={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(c))}catch(u){this.reject(u)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return m_;case"linkViaPopup":case"linkViaRedirect":return __;case"reauthViaPopup":case"reauthViaRedirect":return g_;default:Re(this.auth,"internal-error")}}resolve(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Bw=new wt(2e3,1e4);var y_="pendingRedirect",ni=new Map,ko=class t extends Do{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}execute(){return h(this,null,function*(){let e=ni.get(this.auth._key());if(!e){try{let r=(yield I_(this.resolver,this.auth))?yield Ye(t.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ni.set(this.auth._key(),e)}return this.bypassAuthState||ni.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return h(this,null,function*(){if(e.type==="signInViaRedirect")return Ye(t.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let n=yield this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,Ye(t.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return h(this,null,function*(){})}cleanUp(){}};function I_(t,e){return h(this,null,function*(){let n=w_(e),r=E_(t);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(n))==="true";return yield r._remove(n),i})}function v_(t,e){ni.set(t._key(),e)}function E_(t){return ze(t._redirectPersistence)}function w_(t){return ti(y_,t.config.apiKey,t.name)}function T_(t,e,n=!1){return h(this,null,function*(){if(Ie(t.app))return Promise.reject(je(t));let r=At(t),i=p_(r,e),o=yield new ko(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}var A_=10*60*1e3,No=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!S_(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Ch(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(Et(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){let r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=A_&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hl(e))}saveEventToCache(e){this.cachedEventUids.add(Hl(e)),this.lastProcessedEventTime=Date.now()}};function Hl(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Ch({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function S_(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ch(t);default:return!1}}function b_(n){return h(this,arguments,function*(t,e={}){return st(t,"GET","/v1/projects",e)})}var R_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,P_=/^https?/;function C_(t){return h(this,null,function*(){if(t.config.emulator)return;let{authorizedDomains:e}=yield b_(t);for(let n of e)try{if(D_(n))return}catch{}Re(t,"unauthorized-domain")})}function D_(t){let e=go(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){let o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!P_.test(n))return!1;if(R_.test(t))return r===t;let i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var k_=new wt(3e4,6e4);function Ql(){let t=be().___jsl;if(t?.H){for(let e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function N_(t){return new Promise((e,n)=>{var r,i,s;function o(){Ql(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ql(),n(Et(t,"network-request-failed"))},timeout:k_.get()})}if(!((i=(r=be().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=be().gapi)===null||s===void 0)&&s.load)o();else{let a=_h("iframefcb");return be()[a]=()=>{gapi.load?o():n(Et(t,"network-request-failed"))},gh(`${Lg()}?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw ri=null,e})}var ri=null;function O_(t){return ri=ri||N_(t),ri}var x_=new wt(5e3,15e3),V_="__/auth/iframe",L_="emulator/auth/iframe",M_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},F_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function U_(t){let e=t.config;A(e.authDomain,t,"auth-domain-config-required");let n=e.emulator?Lo(e,L_):`https://${t.config.authDomain}/${V_}`,r={apiKey:e.apiKey,appName:t.name,v:tt},i=F_.get(t.config.apiHost);i&&(r.eid=i);let s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${xn(r).slice(1)}`}function B_(t){return h(this,null,function*(){let e=yield O_(t),n=be().gapi;return A(n,t,"internal-error"),e.open({where:document.body,url:U_(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:M_,dontclear:!0},r=>new Promise((i,s)=>h(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=Et(t,"network-request-failed"),a=be().setTimeout(()=>{s(o)},x_.get());function c(){be().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})})))})}var q_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},$_=500,z_=600,j_="_blank",G_="http://localhost",pi=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function W_(t,e,n,r=$_,i=z_){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",c=Object.assign(Object.assign({},q_),{width:r.toString(),height:i.toString(),top:s,left:o}),u=U().toLowerCase();n&&(a=uh(u)?j_:n),ch(u)&&(e=e||G_,c.scrollbars="yes");let l=Object.entries(c).reduce((f,[m,w])=>`${f}${m}=${w},`,"");if(Cg(u)&&a!=="_self")return K_(e||"",a),new pi(null);let d=window.open(e||"",a,l);A(d,t,"popup-blocked");try{d.focus()}catch{}return new pi(d)}function K_(t,e){let n=document.createElement("a");n.href=t,n.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}var H_="__/auth/handler",Q_="emulator/auth/handler",Y_=encodeURIComponent("fac");function Yl(t,e,n,r,i,s){return h(this,null,function*(){A(t.config.authDomain,t,"auth-domain-config-required"),A(t.config.apiKey,t,"invalid-api-key");let o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:tt,eventId:i};if(e instanceof li){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",wl(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[l,d]of Object.entries(s||{}))o[l]=d}if(e instanceof bo){let l=e.getScopes().filter(d=>d!=="");l.length>0&&(o.scopes=l.join(","))}t.tenantId&&(o.tid=t.tenantId);let a=o;for(let l of Object.keys(a))a[l]===void 0&&delete a[l];let c=yield t._getAppCheckToken(),u=c?`#${Y_}=${encodeURIComponent(c)}`:"";return`${J_(t)}?${xn(a).slice(1)}${u}`})}function J_({config:t}){return t.emulator?Lo(t,Q_):`https://${t.authDomain}/${H_}`}var mo="webStorageSupport",Oo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qo,this._completeRedirectFn=T_,this._overrideRedirectResult=v_}_openPopup(e,n,r,i){return h(this,null,function*(){var s;rt((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield Yl(e,n,r,go(),i);return W_(e,o,Ah())})}_openRedirect(e,n,r,i){return h(this,null,function*(){yield this._originValidation(e);let s=yield Yl(e,n,r,go(),i);return i_(s),new Promise(()=>{})})}_initialize(e){let n=e._key();if(this.eventManagers[n]){let{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(rt(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}initAndGetManager(e){return h(this,null,function*(){let n=yield B_(e),r=new No(e);return n.register("authEvent",i=>(A(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r})}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(mo,{type:mo},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[mo];o!==void 0&&n(!!o),Re(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=C_(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return ph()||Bo()||mi()}},Dh=Oo;var Jl="@firebase/auth",Xl="1.7.1";var xo=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return h(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){A(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function X_(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Z_(t){et(new ge("auth",(e,{options:n})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;A(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mh(t)},u=new To(r,i,s,c);return Ug(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),et(new ge("auth-internal",e=>{let n=At(e.getProvider("auth").getImmediate());return(r=>new xo(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),H(Jl,Xl,X_(t)),H(Jl,Xl,"esm2017")}var ey=5*60,ty=Ks("authIdTokenMaxAge")||ey,Zl=null,ny=t=>e=>h(void 0,null,function*(){let n=e&&(yield e.getIdTokenResult()),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>ty)return;let i=n?.token;Zl!==i&&(Zl=i,yield fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function Yo(t=Xt()){let e=Mn(t,"auth");if(e.isInitialized())return e.getImmediate();let n=qo(t,{popupRedirectResolver:Dh,persistence:[Ph,Th,Qo]}),r=Ks("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=ny(s.toString());Ko(n,o,()=>o(n.currentUser)),Wo(n,a=>o(a))}}let i=Gs("auth");return i&&$o(n,`http://${i}`),n}function ry(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}xg({loadJS(t){return new Promise((e,n)=>{let r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{let s=Et("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",ry().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Z_("Browser");var kh="auth",Kn=class{constructor(e){return e}},Hn=class{constructor(){return Fn(kh)}};var Jo=new Kt("angularfire2.auth-instances");function Ky(t,e){let n=Jr(kh,t,e);return n&&new Kn(n)}function Hy(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new Kn(r)}}var Qy={provide:Hn,deps:[[new me,Jo]]},Yy={provide:Kn,useFactory:Ky,deps:[[new me,Jo],qe]},Jy=(()=>{class t{constructor(){H("angularfire",It.full,"auth")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Ht({type:t});static \u0275inj=Wt({providers:[Yy,Qy]})}return t})();function TT(t,...e){return{ngModule:Jy,providers:[{provide:Jo,useFactory:Hy(t),multi:!0,deps:[Je,Qt,tn,vt,[new me,en],...e]}]}}var AT=Z(jo,!0);var ST=Z(Yo,!0);var bT=Z(Go,!0);var RT=Z(Ho,!0);var Xy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ee={},_,Ia=Ia||{},b=Xy||self;function ki(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function cr(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Zy(t){return Object.prototype.hasOwnProperty.call(t,Xo)&&t[Xo]||(t[Xo]=++eI)}var Xo="closure_uid_"+(1e9*Math.random()>>>0),eI=0;function tI(t,e,n){return t.call.apply(t.bind,arguments)}function nI(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function ie(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ie=tI:ie=nI,ie.apply(null,arguments)}function yi(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function J(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function ot(){this.s=this.s,this.o=this.o}var rI=0;ot.prototype.s=!1;ot.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),rI!=0)&&Zy(this)};ot.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var jh=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function va(t){let e=t.length;if(0<e){let n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Nh(t,e){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(ki(r)){let i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function se(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var iI=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let n=()=>{};b.addEventListener("test",n,e),b.removeEventListener("test",n,e)}catch{}return t}();function er(t){return/^[\s\xa0]*$/.test(t)}function Ni(){var t=b.navigator;return t&&(t=t.userAgent)?t:""}function Pe(t){return Ni().indexOf(t)!=-1}function Ea(t){return Ea[" "](t),t}Ea[" "]=function(){};function sI(t,e){var n=KI;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var oI=Pe("Opera"),cn=Pe("Trident")||Pe("MSIE"),Gh=Pe("Edge"),ra=Gh||cn,Wh=Pe("Gecko")&&!(Ni().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge"))&&!(Pe("Trident")||Pe("MSIE"))&&!Pe("Edge"),aI=Ni().toLowerCase().indexOf("webkit")!=-1&&!Pe("Edge");function Kh(){var t=b.document;return t?t.documentMode:void 0}var ia;e:{if(Ii="",vi=function(){var t=Ni();if(Wh)return/rv:([^\);]+)(\)|;)/.exec(t);if(Gh)return/Edge\/([\d\.]+)/.exec(t);if(cn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(aI)return/WebKit\/(\S+)/.exec(t);if(oI)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),vi&&(Ii=vi?vi[1]:""),cn&&(Ei=Kh(),Ei!=null&&Ei>parseFloat(Ii))){ia=String(Ei);break e}ia=Ii}var Ii,vi,Ei,sa;b.document&&cn?(Zo=Kh(),sa=Zo||parseInt(ia,10)||void 0):sa=void 0;var Zo,cI=sa;function tr(t,e){if(se.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Wh){e:{try{Ea(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:uI[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&tr.$.h.call(this)}}J(tr,se);var uI={2:"touch",3:"pen",4:"mouse"};tr.prototype.h=function(){tr.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ur="closure_listenable_"+(1e6*Math.random()|0),lI=0;function hI(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++lI,this.fa=this.ia=!1}function Oi(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function wa(t,e,n){for(let r in t)e.call(n,t[r],r,t)}function dI(t,e){for(let n in t)e.call(void 0,t[n],n,t)}function Hh(t){let e={};for(let n in t)e[n]=t[n];return e}var Oh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qh(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<Oh.length;s++)n=Oh[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function xi(t){this.src=t,this.g={},this.h=0}xi.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=aa(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new hI(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function oa(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=jh(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Oi(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function aa(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var Ta="closure_lm_"+(1e6*Math.random()|0),ea={};function Yh(t,e,n,r,i){if(r&&r.once)return Xh(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Yh(t,e[s],n,r,i);return null}return n=ba(n),t&&t[ur]?t.O(e,n,cr(r)?!!r.capture:!!r,i):Jh(t,e,n,!1,r,i)}function Jh(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=cr(i)?!!i.capture:!!i,a=Sa(t);if(a||(t[Ta]=a=new xi(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=fI(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)iI||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ed(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function fI(){function t(n){return e.call(t.src,t.listener,n)}let e=pI;return t}function Xh(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Xh(t,e[s],n,r,i);return null}return n=ba(n),t&&t[ur]?t.P(e,n,cr(r)?!!r.capture:!!r,i):Jh(t,e,n,!0,r,i)}function Zh(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Zh(t,e[s],n,r,i);else r=cr(r)?!!r.capture:!!r,n=ba(n),t&&t[ur]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=aa(s,n,r,i),-1<n&&(Oi(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=Sa(t))&&(e=t.g[e.toString()],t=-1,e&&(t=aa(e,n,r,i)),(n=-1<t?e[t]:null)&&Aa(n))}function Aa(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[ur])oa(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ed(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Sa(e))?(oa(n,t),n.h==0&&(n.src=null,e[Ta]=null)):Oi(t)}}}function ed(t){return t in ea?ea[t]:ea[t]="on"+t}function pI(t,e){if(t.fa)t=!0;else{e=new tr(e,this);var n=t.listener,r=t.la||t.src;t.ia&&Aa(t),t=n.call(r,e)}return t}function Sa(t){return t=t[Ta],t instanceof xi?t:null}var ta="__closure_events_fn_"+(1e9*Math.random()>>>0);function ba(t){return typeof t=="function"?t:(t[ta]||(t[ta]=function(e){return t.handleEvent(e)}),t[ta])}function Y(){ot.call(this),this.i=new xi(this),this.S=this,this.J=null}J(Y,ot);Y.prototype[ur]=!0;Y.prototype.removeEventListener=function(t,e,n,r){Zh(this,t,e,n,r)};function te(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new se(e,t);else if(e instanceof se)e.target=e.target||t;else{var i=e;e=new se(r,t),Qh(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=wi(o,r,!0,e)&&i}if(o=e.g=t,i=wi(o,r,!0,e)&&i,i=wi(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=wi(o,r,!1,e)&&i}Y.prototype.N=function(){if(Y.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Oi(n[r]);delete t.g[e],t.h--}}this.J=null};Y.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};Y.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function wi(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&oa(t.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var Ra=b.JSON.stringify,ca=class{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function mI(){var t=Pa;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ua=class{constructor(){this.h=this.g=null}add(e,n){let r=td.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}},td=new ca(()=>new la,t=>t.reset()),la=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function gI(t){var e=1;t=t.split(":");let n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function _I(t){b.setTimeout(()=>{throw t},0)}var nr,rr=!1,Pa=new ua,nd=()=>{let t=b.Promise.resolve(void 0);nr=()=>{t.then(yI)}},yI=()=>{for(var t;t=mI();){try{t.h.call(t.g)}catch(n){_I(n)}var e=td;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}rr=!1};function Vi(t,e){Y.call(this),this.h=t||1,this.g=e||b,this.j=ie(this.qb,this),this.l=Date.now()}J(Vi,Y);_=Vi.prototype;_.ga=!1;_.T=null;_.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),te(this,"tick"),this.ga&&(Ca(this),this.start()))}};_.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ca(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}_.N=function(){Vi.$.N.call(this),Ca(this),delete this.g};function Da(t,e,n){if(typeof t=="function")n&&(t=ie(t,n));else if(t&&typeof t.handleEvent=="function")t=ie(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:b.setTimeout(t,e||0)}function rd(t){t.g=Da(()=>{t.g=null,t.i&&(t.i=!1,rd(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var ha=class extends ot{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:rd(this)}N(){super.N(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function ir(t){ot.call(this),this.h=t,this.g={}}J(ir,ot);var xh=[];function id(t,e,n,r){Array.isArray(n)||(n&&(xh[0]=n.toString()),n=xh);for(var i=0;i<n.length;i++){var s=Yh(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function sd(t){wa(t.g,function(e,n){this.g.hasOwnProperty(n)&&Aa(e)},t),t.g={}}ir.prototype.N=function(){ir.$.N.call(this),sd(this)};ir.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Li(){this.g=!0}Li.prototype.Ea=function(){this.g=!1};function II(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");o=2<=d.length&&d[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function vI(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function on(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+wI(t,n)+(r?" "+r:"")})}function EI(t,e){t.info(function(){return"TIMEOUT: "+e})}Li.prototype.info=function(){};function wI(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Ra(n)}catch{return e}}var Pt={},Vh=null;function Mi(){return Vh=Vh||new Y}Pt.Ta="serverreachability";function od(t){se.call(this,Pt.Ta,t)}J(od,se);function sr(t){let e=Mi();te(e,new od(e))}Pt.STAT_EVENT="statevent";function ad(t,e){se.call(this,Pt.STAT_EVENT,t),this.stat=e}J(ad,se);function ce(t){let e=Mi();te(e,new ad(e,t))}Pt.Ua="timingevent";function cd(t,e){se.call(this,Pt.Ua,t),this.size=e}J(cd,se);function lr(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){t()},e)}var Fi={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ud={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ka(){}ka.prototype.h=null;function Lh(t){return t.h||(t.h=t.i())}function ld(){}var hr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Na(){se.call(this,"d")}J(Na,se);function Oa(){se.call(this,"c")}J(Oa,se);var da;function Ui(){}J(Ui,ka);Ui.prototype.g=function(){return new XMLHttpRequest};Ui.prototype.i=function(){return{}};da=new Ui;function dr(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new ir(this),this.P=TI,t=ra?125:void 0,this.V=new Vi(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new hd}function hd(){this.i=null,this.g="",this.h=!1}var TI=45e3,dd={},fa={};_=dr.prototype;_.setTimeout=function(t){this.P=t};function pa(t,e,n){t.L=1,t.A=qi(We(e)),t.u=n,t.S=!0,fd(t,null)}function fd(t,e){t.G=Date.now(),fr(t),t.B=We(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),Ed(n.i,"t",r),t.o=0,n=t.l.J,t.h=new hd,t.g=$d(t.l,n?e:null,!t.u),0<t.O&&(t.M=new ha(ie(t.Pa,t,t.g),t.O)),id(t.U,t.g,"readystatechange",t.nb),e=t.I?Hh(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),sr(),II(t.j,t.v,t.B,t.m,t.W,t.u)}_.nb=function(t){t=t.target;let e=this.M;e&&Ce(t)==3?e.l():this.Pa(t)};_.Pa=function(t){try{if(t==this.g)e:{let l=Ce(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>l)&&(l!=3||ra||this.g&&(this.h.h||this.g.ja()||Bh(this.g)))){this.J||l!=4||e==7||(e==8||0>=d?sr(3):sr(2)),Bi(this);var n=this.g.da();this.ca=n;t:if(pd(this)){var r=Bh(this.g);t="";var i=r.length,s=Ce(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){St(this),Zn(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,vI(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!er(a)){var u=a;break t}}u=null}if(n=u)on(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ma(this,n);else{this.i=!1,this.s=3,ce(12),St(this),Zn(this);break e}}this.S?(md(this,l,o),ra&&this.i&&l==3&&(id(this.U,this.V,"tick",this.mb),this.V.start())):(on(this.j,this.m,o,null),ma(this,o)),l==4&&St(this),this.i&&!this.J&&(l==4?Fd(this.l,this):(this.i=!1,fr(this)))}else jI(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,ce(12)):(this.s=0,ce(13)),St(this),Zn(this)}}}catch{}finally{}};function pd(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function md(t,e,n){let r=!0,i;for(;!t.J&&t.o<n.length;)if(i=AI(t,n),i==fa){e==4&&(t.s=4,ce(14),r=!1),on(t.j,t.m,null,"[Incomplete Response]");break}else if(i==dd){t.s=4,ce(15),on(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else on(t.j,t.m,i,null),ma(t,i);pd(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,ce(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ua(e),e.M=!0,ce(11))):(on(t.j,t.m,n,"[Invalid Chunked Response]"),St(t),Zn(t))}_.mb=function(){if(this.g){var t=Ce(this.g),e=this.g.ja();this.o<e.length&&(Bi(this),md(this,t,e),this.i&&t!=4&&fr(this))}};function AI(t,e){var n=t.o,r=e.indexOf(`
`,n);return r==-1?fa:(n=Number(e.substring(n,r)),isNaN(n)?dd:(r+=1,r+n>e.length?fa:(e=e.slice(r,r+n),t.o=r+n,e)))}_.cancel=function(){this.J=!0,St(this)};function fr(t){t.Y=Date.now()+t.P,gd(t,t.P)}function gd(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=lr(ie(t.lb,t),e)}function Bi(t){t.C&&(b.clearTimeout(t.C),t.C=null)}_.lb=function(){this.C=null;let t=Date.now();0<=t-this.Y?(EI(this.j,this.B),this.L!=2&&(sr(),ce(17)),St(this),this.s=2,Zn(this)):gd(this,this.Y-t)};function Zn(t){t.l.H==0||t.J||Fd(t.l,t)}function St(t){Bi(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,Ca(t.V),sd(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function ma(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||ga(n.i,t))){if(!t.K&&ga(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Ri(n),ji(n);else break e;Fa(n),ce(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=lr(ie(n.ib,n),6e3));if(1>=Ad(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else bt(n,11)}else if((t.K||n.g==t)&&Ri(n),!er(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],n.H==2)if(u[0]=="c"){n.K=u[1],n.pa=u[2];let l=u[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let d=u[4];d!=null&&(n.Ga=d,n.l.info("SVER="+n.Ga));let f=u[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let m=t.g;if(m){let w=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var s=r.i;s.g||w.indexOf("spdy")==-1&&w.indexOf("quic")==-1&&w.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(xa(s,s.h),s.h=null))}if(r.F){let T=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;T&&(r.Da=T,L(r.I,r.F,T))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=qd(r,r.J?r.pa:null,r.Y),o.K){Sd(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Bi(a),fr(a)),r.g=o}else Ld(r);0<n.j.length&&Gi(n)}else u[0]!="stop"&&u[0]!="close"||bt(n,7);else n.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?bt(n,7):Ma(n):u[0]!="noop"&&n.h&&n.h.Aa(u),n.A=0)}}sr(4)}catch{}}function SI(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(ki(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function bI(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(ki(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(let r in t)e[n++]=r;return e}}}function _d(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(ki(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=bI(t),r=SI(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var yd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function RI(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Rt(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Rt){this.h=t.h,Si(this,t.j),this.s=t.s,this.g=t.g,bi(this,t.m),this.l=t.l;var e=t.i,n=new or;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Mh(this,n),this.o=t.o}else t&&(e=String(t).match(yd))?(this.h=!1,Si(this,e[1]||"",!0),this.s=Jn(e[2]||""),this.g=Jn(e[3]||"",!0),bi(this,e[4]),this.l=Jn(e[5]||"",!0),Mh(this,e[6]||"",!0),this.o=Jn(e[7]||"")):(this.h=!1,this.i=new or(null,this.h))}Rt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Xn(e,Fh,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(Xn(e,Fh,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(Xn(n,n.charAt(0)=="/"?DI:CI,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Xn(n,NI)),t.join("")};function We(t){return new Rt(t)}function Si(t,e,n){t.j=n?Jn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function bi(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Mh(t,e,n){e instanceof or?(t.i=e,OI(t.i,t.h)):(n||(e=Xn(e,kI)),t.i=new or(e,t.h))}function L(t,e,n){t.i.set(e,n)}function qi(t){return L(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Jn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xn(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,PI),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function PI(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Fh=/[#\/\?@]/g,CI=/[#\?:]/g,DI=/[#\?]/g,kI=/[#\?@]/g,NI=/#/g;function or(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function at(t){t.g||(t.g=new Map,t.h=0,t.i&&RI(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}_=or.prototype;_.add=function(t,e){at(this),this.i=null,t=un(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function Id(t,e){at(t),e=un(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function vd(t,e){return at(t),e=un(t,e),t.g.has(e)}_.forEach=function(t,e){at(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};_.ta=function(){at(this);let t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){let i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};_.Z=function(t){at(this);let e=[];if(typeof t=="string")vd(this,t)&&(e=e.concat(this.g.get(un(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};_.set=function(t,e){return at(this),this.i=null,t=un(this,t),vd(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};_.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function Ed(t,e,n){Id(t,e),0<n.length&&(t.i=null,t.g.set(un(t,e),va(n)),t.h+=n.length)}_.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function un(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function OI(t,e){e&&!t.j&&(at(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Id(this,r),Ed(this,i,n))},t)),t.j=e}var xI=class{constructor(t,e){this.g=t,this.map=e}};function wd(t){this.l=t||VI,b.PerformanceNavigationTiming?(t=b.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(b.g&&b.g.Ka&&b.g.Ka()&&b.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var VI=10;function Td(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function Ad(t){return t.h?1:t.g?t.g.size:0}function ga(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function xa(t,e){t.g?t.g.add(e):t.h=e}function Sd(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}wd.prototype.cancel=function(){if(this.i=bd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function bd(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.F);return e}return va(t.i)}var LI=class{stringify(t){return b.JSON.stringify(t,void 0)}parse(t){return b.JSON.parse(t,void 0)}};function MI(){this.g=new LI}function FI(t,e,n){let r=n||"";try{_d(t,function(i,s){let o=i;cr(i)&&(o=Ra(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function UI(t,e){let n=new Li;if(b.Image){let r=new Image;r.onload=yi(Ti,n,r,"TestLoadImage: loaded",!0,e),r.onerror=yi(Ti,n,r,"TestLoadImage: error",!1,e),r.onabort=yi(Ti,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=yi(Ti,n,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Ti(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function pr(t){this.l=t.ec||null,this.j=t.ob||!1}J(pr,ka);pr.prototype.g=function(){return new $i(this.l,this.j)};pr.prototype.i=function(t){return function(){return t}}({});function $i(t,e){Y.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Va,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}J($i,Y);var Va=0;_=$i.prototype;_.open=function(t,e){if(this.readyState!=Va)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ar(this)};_.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||b).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,mr(this)),this.readyState=Va};_.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ar(this)),this.g&&(this.readyState=3,ar(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof b.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Rd(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function Rd(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}_.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?mr(this):ar(this),this.readyState==3&&Rd(this)}};_.Za=function(t){this.g&&(this.response=this.responseText=t,mr(this))};_.Ya=function(t){this.g&&(this.response=t,mr(this))};_.ka=function(){this.g&&mr(this)};function mr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ar(t)}_.setRequestHeader=function(t,e){this.v.append(t,e)};_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};_.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function ar(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty($i.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var BI=b.JSON.parse;function B(t){Y.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Pd,this.L=this.M=!1}J(B,Y);var Pd="",qI=/^https?$/i,$I=["POST","PUT"];_=B.prototype;_.Oa=function(t){this.M=t};_.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():da.g(),this.C=this.u?Lh(this.u):Lh(da),this.g.onreadystatechange=ie(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){Uh(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=b.FormData&&t instanceof b.FormData,!(0<=jh($I,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{kd(this),0<this.B&&((this.L=zI(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ie(this.ua,this)):this.A=Da(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Uh(this,s)}};function zI(t){return cn&&typeof t.timeout=="number"&&t.ontimeout!==void 0}_.ua=function(){typeof Ia<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,te(this,"timeout"),this.abort(8))};function Uh(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Cd(t),zi(t)}function Cd(t){t.F||(t.F=!0,te(t,"complete"),te(t,"error"))}_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,te(this,"complete"),te(this,"abort"),zi(this))};_.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zi(this,!0)),B.$.N.call(this)};_.La=function(){this.s||(this.G||this.v||this.l?Dd(this):this.kb())};_.kb=function(){Dd(this)};function Dd(t){if(t.h&&typeof Ia<"u"&&(!t.C[1]||Ce(t)!=4||t.da()!=2)){if(t.v&&Ce(t)==4)Da(t.La,0,t);else if(te(t,"readystatechange"),Ce(t)==4){t.h=!1;try{let o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(yd)[1]||null;!i&&b.self&&b.self.location&&(i=b.self.location.protocol.slice(0,-1)),r=!qI.test(i?i.toLowerCase():"")}n=r}if(n)te(t,"complete"),te(t,"success");else{t.m=6;try{var s=2<Ce(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",Cd(t)}}finally{zi(t)}}}}function zi(t,e){if(t.g){kd(t);let n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||te(t,"ready");try{n.onreadystatechange=r}catch{}}}function kd(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(b.clearTimeout(t.A),t.A=null)}_.isActive=function(){return!!this.g};function Ce(t){return t.g?t.g.readyState:0}_.da=function(){try{return 2<Ce(this)?this.g.status:-1}catch{return-1}};_.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};_.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),BI(e)}};function Bh(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Pd:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function jI(t){let e={};t=(t.g&&2<=Ce(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(er(t[r]))continue;var n=gI(t[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=e[i]||[];e[i]=s,s.push(n)}dI(e,function(r){return r.join(", ")})}_.Ia=function(){return this.m};_.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Nd(t){let e="";return wa(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function La(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Nd(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):L(t,e,n))}function Qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Od(t){this.Ga=0,this.j=[],this.l=new Li,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Qn("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Qn("baseRetryDelayMs",5e3,t),this.hb=Qn("retryDelaySeedMs",1e4,t),this.eb=Qn("forwardChannelMaxRetries",2,t),this.xa=Qn("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new wd(t&&t.concurrentRequestLimit),this.Ja=new MI,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}_=Od.prototype;_.ra=8;_.H=1;function Ma(t){if(xd(t),t.H==3){var e=t.W++,n=We(t.I);if(L(n,"SID",t.K),L(n,"RID",e),L(n,"TYPE","terminate"),gr(t,n),e=new dr(t,t.l,e),e.L=2,e.A=qi(We(n)),n=!1,b.navigator&&b.navigator.sendBeacon)try{n=b.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&b.Image&&(new Image().src=e.A,n=!0),n||(e.g=$d(e.l,null),e.g.ha(e.A)),e.G=Date.now(),fr(e)}Bd(t)}function ji(t){t.g&&(Ua(t),t.g.cancel(),t.g=null)}function xd(t){ji(t),t.u&&(b.clearTimeout(t.u),t.u=null),Ri(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&b.clearTimeout(t.m),t.m=null)}function Gi(t){if(!Td(t.i)&&!t.m){t.m=!0;var e=t.Na;nr||nd(),rr||(nr(),rr=!0),Pa.add(e,t),t.C=0}}function GI(t,e){return Ad(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=lr(ie(t.Na,t,e),Ud(t,t.C)),t.C++,!0)}_.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;let i=new dr(this,this.l,t),s=this.s;if(this.U&&(s?(s=Hh(s),Qh(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=Vd(this,i,e),n=We(this.I),L(n,"RID",t),L(n,"CVER",22),this.F&&L(n,"X-HTTP-Session-Id",this.F),gr(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Nd(s)))+"&"+e:this.o&&La(n,this.o,s)),xa(this.i,i),this.bb&&L(n,"TYPE","init"),this.P?(L(n,"$req",e),L(n,"SID","null"),i.aa=!0,pa(i,n,null)):pa(i,n,e),this.H=2}}else this.H==3&&(t?qh(this,t):this.j.length==0||Td(this.i)||qh(this))};function qh(t,e){var n;e?n=e.m:n=t.W++;let r=We(t.I);L(r,"SID",t.K),L(r,"RID",n),L(r,"AID",t.V),gr(t,r),t.o&&t.s&&La(r,t.o,t.s),n=new dr(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Vd(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),xa(t.i,n),pa(n,r,e)}function gr(t,e){t.na&&wa(t.na,function(n,r){L(e,r,n)}),t.h&&_d({},function(n,r){L(e,r,n)})}function Vd(t,e,n){n=Math.min(t.j.length,n);var r=t.h?ie(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<n;c++){let u=i[c].g,l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{FI(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function Ld(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;nr||nd(),rr||(nr(),rr=!0),Pa.add(e,t),t.A=0}}function Fa(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=lr(ie(t.Ma,t),Ud(t,t.A)),t.A++,!0)}_.Ma=function(){if(this.u=null,Md(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=lr(ie(this.jb,this),t)}};_.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ce(10),ji(this),Md(this))};function Ua(t){t.B!=null&&(b.clearTimeout(t.B),t.B=null)}function Md(t){t.g=new dr(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=We(t.wa);L(e,"RID","rpc"),L(e,"SID",t.K),L(e,"AID",t.V),L(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&L(e,"TO",t.qa),L(e,"TYPE","xmlhttp"),gr(t,e),t.o&&t.s&&La(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=qi(We(e)),n.u=null,n.S=!0,fd(n,t)}_.ib=function(){this.v!=null&&(this.v=null,ji(this),Fa(this),ce(19))};function Ri(t){t.v!=null&&(b.clearTimeout(t.v),t.v=null)}function Fd(t,e){var n=null;if(t.g==e){Ri(t),Ua(t),t.g=null;var r=2}else if(ga(t.i,e))n=e.F,Sd(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;r=Mi(),te(r,new cd(r,n)),Gi(t)}else Ld(t);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&GI(t,e)||r==2&&Fa(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:bt(t,5);break;case 4:bt(t,10);break;case 3:bt(t,6);break;default:bt(t,2)}}}function Ud(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function bt(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=ie(t.pb,t);n||(n=new Rt("//www.google.com/images/cleardot.gif"),b.location&&b.location.protocol=="http"||Si(n,"https"),qi(n)),UI(n.toString(),r)}else ce(2);t.H=0,t.h&&t.h.za(e),Bd(t),xd(t)}_.pb=function(t){t?(this.l.info("Successfully pinged google.com"),ce(2)):(this.l.info("Failed to ping google.com"),ce(1))};function Bd(t){if(t.H=0,t.ma=[],t.h){let e=bd(t.i);(e.length!=0||t.j.length!=0)&&(Nh(t.ma,e),Nh(t.ma,t.j),t.i.i.length=0,va(t.j),t.j.length=0),t.h.ya()}}function qd(t,e,n){var r=n instanceof Rt?We(n):new Rt(n);if(r.g!="")e&&(r.g=e+"."+r.g),bi(r,r.m);else{var i=b.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Rt(null);r&&Si(s,r),e&&(s.g=e),i&&bi(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&L(r,n,e),L(r,"VER",t.ra),gr(t,r),r}function $d(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new B(new pr({ob:n})):new B(t.va),e.Oa(t.J),e}_.isActive=function(){return!!this.h&&this.h.isActive(this)};function zd(){}_=zd.prototype;_.Ba=function(){};_.Aa=function(){};_.za=function(){};_.ya=function(){};_.isActive=function(){return!0};_.Va=function(){};function Pi(){if(cn&&!(10<=Number(cI)))throw Error("Environmental error: no available transport.")}Pi.prototype.g=function(t,e){return new de(t,e)};function de(t,e){Y.call(this),this.g=new Od(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!er(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!er(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new ln(this)}J(de,Y);de.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;ce(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=qd(t,null,t.Y),Gi(t)};de.prototype.close=function(){Ma(this.g)};de.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=Ra(t),t=n);e.j.push(new xI(e.fb++,t)),e.H==3&&Gi(e)};de.prototype.N=function(){this.g.h=null,delete this.j,Ma(this.g),delete this.g,de.$.N.call(this)};function jd(t){Na.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}J(jd,Na);function Gd(){Oa.call(this),this.status=1}J(Gd,Oa);function ln(t){this.g=t}J(ln,zd);ln.prototype.Ba=function(){te(this.g,"a")};ln.prototype.Aa=function(t){te(this.g,new jd(t))};ln.prototype.za=function(t){te(this.g,new Gd)};ln.prototype.ya=function(){te(this.g,"b")};function WI(){this.blockSize=-1}function ve(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}J(ve,WI);ve.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function na(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}ve.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)na(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){na(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){na(this,r),i=0;break}}this.h=i,this.i+=e};ve.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function x(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var KI={};function Ba(t){return-128<=t&&128>t?sI(t,function(e){return new x([e|0],0>e?-1:0)}):new x([t|0],0>t?-1:0)}function De(t){if(isNaN(t)||!isFinite(t))return an;if(0>t)return ee(De(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=_a;return new x(e,0)}function Wd(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return ee(Wd(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=De(Math.pow(e,8)),r=an,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=De(Math.pow(e,s)),r=r.R(s).add(De(o))):(r=r.R(n),r=r.add(De(o)))}return r}var _a=4294967296,an=Ba(0),ya=Ba(1),$h=Ba(16777216);_=x.prototype;_.ea=function(){if(_e(this))return-ee(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:_a+r)*e,e*=_a}return t};_.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Ge(this))return"0";if(_e(this))return"-"+ee(this).toString(t);for(var e=De(Math.pow(t,6)),n=this,r="";;){var i=Di(n,e).g;n=Ci(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,Ge(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};_.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Ge(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function _e(t){return t.h==-1}_.X=function(t){return t=Ci(this,t),_e(t)?-1:Ge(t)?0:1};function ee(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new x(n,~t.h).add(ya)}_.abs=function(){return _e(this)?ee(this):this};_.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new x(n,n[n.length-1]&-2147483648?-1:0)};function Ci(t,e){return t.add(ee(e))}_.R=function(t){if(Ge(this)||Ge(t))return an;if(_e(this))return _e(t)?ee(this).R(ee(t)):ee(ee(this).R(t));if(_e(t))return ee(this.R(ee(t)));if(0>this.X($h)&&0>t.X($h))return De(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,c=t.D(i)&65535;n[2*r+2*i]+=o*c,Ai(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Ai(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Ai(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Ai(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new x(n,0)};function Ai(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Yn(t,e){this.g=t,this.h=e}function Di(t,e){if(Ge(e))throw Error("division by zero");if(Ge(t))return new Yn(an,an);if(_e(t))return e=Di(ee(t),e),new Yn(ee(e.g),ee(e.h));if(_e(e))return e=Di(t,ee(e)),new Yn(ee(e.g),e.h);if(30<t.g.length){if(_e(t)||_e(e))throw Error("slowDivide_ only works with positive integers.");for(var n=ya,r=e;0>=r.X(t);)n=zh(n),r=zh(r);var i=sn(n,1),s=sn(r,1);for(r=sn(r,2),n=sn(n,2);!Ge(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=sn(r,1),n=sn(n,1)}return e=Ci(t,i.R(e)),new Yn(i,e)}for(i=an;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=De(n),o=s.R(e);_e(o)||0<o.X(t);)n-=r,s=De(n),o=s.R(e);Ge(s)&&(s=ya),i=i.add(s),t=Ci(t,o)}return new Yn(i,t)}_.gb=function(t){return Di(this,t).h};_.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new x(n,this.h&t.h)};_.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new x(n,this.h|t.h)};_.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new x(n,this.h^t.h)};function zh(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new x(n,t.h)}function sn(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new x(i,t.h)}Pi.prototype.createWebChannel=Pi.prototype.g;de.prototype.send=de.prototype.u;de.prototype.open=de.prototype.m;de.prototype.close=de.prototype.close;Fi.NO_ERROR=0;Fi.TIMEOUT=8;Fi.HTTP_ERROR=6;ud.COMPLETE="complete";ld.EventType=hr;hr.OPEN="a";hr.CLOSE="b";hr.ERROR="c";hr.MESSAGE="d";Y.prototype.listen=Y.prototype.O;B.prototype.listenOnce=B.prototype.P;B.prototype.getLastError=B.prototype.Sa;B.prototype.getLastErrorCode=B.prototype.Ia;B.prototype.getStatus=B.prototype.da;B.prototype.getResponseJson=B.prototype.Wa;B.prototype.getResponseText=B.prototype.ja;B.prototype.send=B.prototype.ha;B.prototype.setWithCredentials=B.prototype.Oa;ve.prototype.digest=ve.prototype.l;ve.prototype.reset=ve.prototype.reset;ve.prototype.update=ve.prototype.j;x.prototype.add=x.prototype.add;x.prototype.multiply=x.prototype.R;x.prototype.modulo=x.prototype.gb;x.prototype.compare=x.prototype.X;x.prototype.toNumber=x.prototype.ea;x.prototype.toString=x.prototype.toString;x.prototype.getBits=x.prototype.D;x.fromNumber=De;x.fromString=Wd;var Kd=Ee.createWebChannelTransport=function(){return new Pi},Hd=Ee.getStatEventTarget=function(){return Mi()},Wi=Ee.ErrorCode=Fi,Qd=Ee.EventType=ud,Yd=Ee.Event=Pt,qa=Ee.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},DT=Ee.FetchXmlHttpFactory=pr,_r=Ee.WebChannel=ld,Jd=Ee.XhrIo=B,Xd=Ee.Md5=ve,Ct=Ee.Integer=x;var Zd="@firebase/firestore";var X=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};X.UNAUTHENTICATED=new X(null),X.GOOGLE_CREDENTIALS=new X("google-credentials-uid"),X.FIRST_PARTY=new X("first-party-uid"),X.MOCK_USER=new X("mock-user");var Cn="10.11.0";var Vt=new Xe("@firebase/firestore");function yr(){return Vt.logLevel}function y(t,...e){if(Vt.logLevel<=C.DEBUG){let n=e.map(ku);Vt.debug(`Firestore (${Cn}): ${t}`,...n)}}function Le(t,...e){if(Vt.logLevel<=C.ERROR){let n=e.map(ku);Vt.error(`Firestore (${Cn}): ${t}`,...n)}}function _n(t,...e){if(Vt.logLevel<=C.WARN){let n=e.map(ku);Vt.warn(`Firestore (${Cn}): ${t}`,...n)}}function ku(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function S(t="Unexpected state"){let e=`FIRESTORE (${Cn}) INTERNAL ASSERTION FAILED: `+t;throw Le(e),new Error(e)}function V(t,e){t||S()}function R(t,e){return t}var p={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},I=class extends he{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ne=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var Ji=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Wa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(X.UNAUTHENTICATED))}shutdown(){}},Ka=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Ha=class{constructor(e){this.t=e,this.currentUser=X.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i,i=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve(),s=new Ne;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ne,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(()=>h(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},a=c=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ne)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(V(typeof r.accessToken=="string"),new Ji(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return V(e===null||typeof e=="string"),new X(e)}},Qa=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=X.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Ya=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new Qa(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(X.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ja=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Xa=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){let r=s=>{s.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(V(typeof n.token=="string"),this.R=n.token,new Ja(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function HI(t){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Xi=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=HI(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}};function O(t,e){return t<e?-1:t>e?1:0}function yn(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}var ne=class t{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new I(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new I(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new I(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new I(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return t.fromMillis(Date.now())}static fromDate(e){return t.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new t(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?O(this.nanoseconds,e.nanoseconds):O(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var P=class t{constructor(e){this.timestamp=e}static fromTimestamp(e){return new t(e)}static min(){return new t(new ne(0,0))}static max(){return new t(new ne(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Zi=class t{constructor(e,n,r){n===void 0?n=0:n>e.length&&S(),r===void 0?r=e.length-n:r>e.length-n&&S(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return t.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let r=Math.min(e.length,n.length);for(let i=0;i<r;i++){let s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},F=class t extends Zi{construct(e,n,r){return new t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let r of e){if(r.indexOf("//")>=0)throw new I(p.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new t(n)}static emptyPath(){return new t([])}},QI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,pe=class t extends Zi{construct(e,n,r){return new t(e,n,r)}static isValidIdentifier(e){return QI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new t(["__name__"])}static fromServerFormat(e){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new I(p.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new I(p.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new I(p.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new I(p.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(n)}static emptyPath(){return new t([])}};var E=class t{constructor(e){this.path=e}static fromPath(e){return new t(F.fromString(e))}static fromName(e){return new t(F.fromString(e).popFirst(5))}static empty(){return new t(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&F.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return F.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t(new F(e.slice()))}};var Za=class{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}};Za.UNKNOWN_ID=-1;function YI(t,e){let n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=P.fromTimestamp(r===1e9?new ne(n+1,0):new ne(n,r));return new Lt(i,E.empty(),e)}function JI(t){return new Lt(t.readTime,t.key,-1)}var Lt=class t{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new t(P.min(),E.empty(),-1)}static max(){return new t(P.max(),E.empty(),-1)}};function XI(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=E.comparator(t.documentKey,e.documentKey),n!==0?n:O(t.largestBatchId,e.largestBatchId))}var ZI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ec=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Lr(t){return h(this,null,function*(){if(t.code!==p.FAILED_PRECONDITION||t.message!==ZI)throw t;y("LocalStore","Unexpectedly lost primary lease")})}var g=class t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{let n=e();return n instanceof t?n:t.resolve(n)}catch(n){return t.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):t.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):t.reject(n)}static resolve(e){return new t((n,r)=>{n(e)})}static reject(e){return new t((n,r)=>{r(e)})}static waitFor(e){return new t((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},c=>r(c))}),o=!0,s===i&&n()})}static or(e){let n=t.resolve(!1);for(let r of e)n=n.next(i=>i?t.resolve(i):r());return n}static forEach(e,n){let r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new t((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;n(e[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,n){return new t((r,i)=>{let s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}};var tc=class t{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new Ne,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new xt(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Nu(r.target.error);this.V.reject(new xt(e,i))}}static open(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(s){throw new xt(n,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(y("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let n=this.transaction.objectStore(e);return new rc(n)}},es=class t{constructor(e,n,r){this.name=e,this.version=n,this.p=r,t.S(U())===12.2&&Le("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return y("SimpleDb","Removing database:",e),Dt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Wr())return!1;if(t.C())return!0;let e=U(),n=t.S(e),r=0<n&&n<10,i=t.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,n){return e.store(n)}static S(e){let n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let n=e.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return h(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;n(o)},i.onblocked=()=>{r(new xt(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new I(p.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new I(p.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new xt(e,o))},i.onupgradeneeded=s=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=n=>this.L(n)),this.db})}B(e){this.L=e,this.db&&(this.db.onversionchange=n=>e(n))}runTransaction(e,n,r,i){return h(this,null,function*(){let s=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=tc.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),g.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}},nc=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Dt(this.k.delete())}},xt=class extends I{constructor(e,n){super(p.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function Mr(t){return t.name==="IndexedDbTransactionError"}var rc=class{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(y("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Dt(r)}add(e){return y("SimpleDb","ADD",this.store.name,e,e),Dt(this.store.add(e))}get(e){return Dt(this.store.get(e)).next(n=>(n===void 0&&(n=null),y("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return y("SimpleDb","DELETE",this.store.name,e),Dt(this.store.delete(e))}count(){return y("SimpleDb","COUNT",this.store.name),Dt(this.store.count())}W(e,n){let r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new g((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,c)=>{o.push(c)}).next(()=>o)}}j(e,n){let r=this.store.getAll(e,n===null?void 0:n);return new g((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,n){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,n);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,n){let r;n?r=e:(r={},n=e);let i=this.cursor(r);return this.G(i,n)}Z(e){let n=this.cursor({});return new g((r,i)=>{n.onerror=s=>{let o=Nu(s.target.error);i(o)},n.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,n){let r=[];return new g((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new nc(a),u=n(a.primaryKey,a.value,c);if(u instanceof g){let l=u.catch(d=>(c.done(),g.reject(d)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>g.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}};function Dt(t){return new g((e,n)=>{t.onsuccess=r=>{let i=r.target.result;e(i)},t.onerror=r=>{let i=Nu(r.target.error);n(i)}})}var ef=!1;function Nu(t){let e=es.S(U());if(e>=12.2&&e<13){let n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){let r=new I("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ef||(ef=!0,setTimeout(()=>{throw r},0)),r}}return t}var xf=(()=>{class t{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return t._e=-1,t})();function Cs(t){return t==null}function Ar(t){return t===0&&1/t==-1/0}function ev(t){return typeof t=="number"&&Number.isInteger(t)&&!Ar(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var tv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],BT=[...tv,"documentOverlays"],nv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],rv=nv,qT=[...rv,"indexConfiguration","indexState","indexEntries"];function tf(t){let e=0;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function zt(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Vf(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var $=class t{constructor(e,n){this.comparator=e,this.root=n||Oe.EMPTY}insert(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Oe.BLACK,null,null))}remove(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oe.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){let e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pn(this.root,e,this.comparator,!1)}getReverseIterator(){return new pn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pn(this.root,e,this.comparator,!0)}},pn=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Oe=class t{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??t.RED,this.left=i??t.EMPTY,this.right=s??t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new t(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};Oe.EMPTY=null,Oe.RED=!0,Oe.BLACK=!1;Oe.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,n,r,i,s){return this}insert(e,n,r){return new Oe(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ae=class t{constructor(e){this.comparator=e,this.data=new $(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new ts(this.data.getIterator())}getIteratorFrom(e){return new ts(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new t(this.comparator);return n.data=e,n}},ts=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var ye=class t{constructor(e){this.fields=e,e.sort(pe.comparator)}static empty(){return new t([])}unionWith(e){let n=new ae(pe.comparator);for(let r of this.fields)n=n.add(r);for(let r of e)n=n.add(r);return new t(n.toArray())}covers(e){for(let n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return yn(this.fields,e.fields,(n,r)=>n.isEqual(r))}};var ns=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ue=class t{constructor(e){this.binaryString=e}static fromBase64String(e){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ns("Invalid base64 string: "+s):s}}(e);return new t(n)}static fromUint8Array(e){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new t(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return O(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ue.EMPTY_BYTE_STRING=new ue("");var iv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function He(t){if(V(!!t),typeof t=="string"){let e=0,n=iv.exec(t);if(V(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:q(t.seconds),nanos:q(t.nanos)}}function q(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function lt(t){return typeof t=="string"?ue.fromBase64String(t):ue.fromUint8Array(t)}function Ou(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function xu(t){let e=t.mapValue.fields.__previous_value__;return Ou(e)?xu(e):e}function Sr(t){let e=He(t.mapValue.fields.__local_write_time__.timestampValue);return new ne(e.seconds,e.nanos)}var ic=class{constructor(e,n,r,i,s,o,a,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},rs=class t{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new t("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}};var Ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Mt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ou(t)?4:Lf(t)?9007199254740991:10:S()}function Me(t,e){if(t===e)return!0;let n=Mt(t);if(n!==Mt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Sr(t).isEqual(Sr(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=He(i.timestampValue),a=He(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return lt(i.bytesValue).isEqual(lt(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return q(i.geoPointValue.latitude)===q(s.geoPointValue.latitude)&&q(i.geoPointValue.longitude)===q(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return q(i.integerValue)===q(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=q(i.doubleValue),a=q(s.doubleValue);return o===a?Ar(o)===Ar(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return yn(t.arrayValue.values||[],e.arrayValue.values||[],Me);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(tf(o)!==tf(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Me(o[c],a[c])))return!1;return!0}(t,e);default:return S()}}function br(t,e){return(t.values||[]).find(n=>Me(n,e))!==void 0}function In(t,e){if(t===e)return 0;let n=Mt(t),r=Mt(e);if(n!==r)return O(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return O(t.booleanValue,e.booleanValue);case 2:return function(s,o){let a=q(s.integerValue||s.doubleValue),c=q(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(t,e);case 3:return nf(t.timestampValue,e.timestampValue);case 4:return nf(Sr(t),Sr(e));case 5:return O(t.stringValue,e.stringValue);case 6:return function(s,o){let a=lt(s),c=lt(o);return a.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let l=O(a[u],c[u]);if(l!==0)return l}return O(a.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){let a=O(q(s.latitude),q(o.latitude));return a!==0?a:O(q(s.longitude),q(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){let l=In(a[u],c[u]);if(l)return l}return O(a.length,c.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Ki.mapValue&&o===Ki.mapValue)return 0;if(s===Ki.mapValue)return 1;if(o===Ki.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let d=0;d<c.length&&d<l.length;++d){let f=O(c[d],l[d]);if(f!==0)return f;let m=In(a[c[d]],u[l[d]]);if(m!==0)return m}return O(c.length,l.length)}(t.mapValue,e.mapValue);default:throw S()}}function nf(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return O(t,e);let n=He(t),r=He(e),i=O(n.seconds,r.seconds);return i!==0?i:O(n.nanos,r.nanos)}function vn(t){return sc(t)}function sc(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){let r=He(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return lt(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return E.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=sc(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${sc(n.fields[o])}`;return i+"}"}(t.mapValue):S()}function rf(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function oc(t){return!!t&&"integerValue"in t}function Vu(t){return!!t&&"arrayValue"in t}function sf(t){return!!t&&"nullValue"in t}function of(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Qi(t){return!!t&&"mapValue"in t}function vr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let e={mapValue:{fields:{}}};return zt(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=vr(r)),e}if(t.arrayValue){let e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=vr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Lf(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var fe=class t{constructor(e){this.value=e}static empty(){return new t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Qi(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=vr(n)}setAll(e){let n=pe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let c=this.getFieldsMap(n);this.applyChanges(c,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=vr(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){let n=this.field(e.popLast());Qi(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Me(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Qi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){zt(n,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new t(vr(this.value))}};function Mf(t){let e=[];return zt(t.fields,(n,r)=>{let i=new pe([n]);if(Qi(r)){let s=Mf(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new ye(e)}var we=class t{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new t(e,0,P.min(),P.min(),P.min(),fe.empty(),0)}static newFoundDocument(e,n,r,i){return new t(e,1,n,P.min(),r,i,0)}static newNoDocument(e,n){return new t(e,2,n,P.min(),P.min(),fe.empty(),0)}static newUnknownDocument(e,n){return new t(e,3,n,P.min(),P.min(),fe.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(P.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var En=class{constructor(e,n){this.position=e,this.inclusive=n}};function af(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){let s=e[i],o=t.position[i];if(s.field.isKeyField()?r=E.comparator(E.fromName(o.referenceValue),n.key):r=In(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function cf(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Me(t.position[n],e.position[n]))return!1;return!0}var Ft=class{constructor(e,n="asc"){this.field=e,this.dir=n}};function sv(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var is=class{},K=class t extends is{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new cc(e,n,r):n==="array-contains"?new hc(e,r):n==="in"?new dc(e,r):n==="not-in"?new fc(e,r):n==="array-contains-any"?new pc(e,r):new t(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new uc(e,r):new lc(e,r)}matches(e){let n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(In(n,this.value)):n!==null&&Mt(this.value)===Mt(n)&&this.matchesComparison(In(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Te=class t extends is{constructor(e,n){super(),this.filters=e,this.op=n,this.ue=null}static create(e,n){return new t(e,n)}matches(e){return Ff(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Ff(t){return t.op==="and"}function Uf(t){return ov(t)&&Ff(t)}function ov(t){for(let e of t.filters)if(e instanceof Te)return!1;return!0}function ac(t){if(t instanceof K)return t.field.canonicalString()+t.op.toString()+vn(t.value);if(Uf(t))return t.filters.map(e=>ac(e)).join(",");{let e=t.filters.map(n=>ac(n)).join(",");return`${t.op}(${e})`}}function Bf(t,e){return t instanceof K?function(r,i){return i instanceof K&&r.op===i.op&&r.field.isEqual(i.field)&&Me(r.value,i.value)}(t,e):t instanceof Te?function(r,i){return i instanceof Te&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Bf(o,i.filters[a]),!0):!1}(t,e):void S()}function qf(t){return t instanceof K?function(n){return`${n.field.canonicalString()} ${n.op} ${vn(n.value)}`}(t):t instanceof Te?function(n){return n.op.toString()+" {"+n.getFilters().map(qf).join(" ,")+"}"}(t):"Filter"}var cc=class extends K{constructor(e,n,r){super(e,n,r),this.key=E.fromName(r.referenceValue)}matches(e){let n=E.comparator(e.key,this.key);return this.matchesComparison(n)}},uc=class extends K{constructor(e,n){super(e,"in",n),this.keys=$f("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}},lc=class extends K{constructor(e,n){super(e,"not-in",n),this.keys=$f("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}};function $f(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>E.fromName(r.referenceValue))}var hc=class extends K{constructor(e,n){super(e,"array-contains",n)}matches(e){let n=e.data.field(this.field);return Vu(n)&&br(n.arrayValue,this.value)}},dc=class extends K{constructor(e,n){super(e,"in",n)}matches(e){let n=e.data.field(this.field);return n!==null&&br(this.value.arrayValue,n)}},fc=class extends K{constructor(e,n){super(e,"not-in",n)}matches(e){if(br(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=e.data.field(this.field);return n!==null&&!br(this.value.arrayValue,n)}},pc=class extends K{constructor(e,n){super(e,"array-contains-any",n)}matches(e){let n=e.data.field(this.field);return!(!Vu(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>br(this.value.arrayValue,r))}};var mc=class{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function uf(t,e=null,n=[],r=[],i=null,s=null,o=null){return new mc(t,e,n,r,i,s,o)}function Lu(t){let e=R(t);if(e.ce===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>ac(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Cs(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>vn(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>vn(r)).join(",")),e.ce=n}return e.ce}function Mu(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!sv(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Bf(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cf(t.startAt,e.startAt)&&cf(t.endAt,e.endAt)}function gc(t){return E.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}var ht=class{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function av(t,e,n,r,i,s,o,a){return new ht(t,e,n,r,i,s,o,a)}function Fu(t){return new ht(t)}function lf(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function zf(t){return t.collectionGroup!==null}function Er(t){let e=R(t);if(e.le===null){e.le=[];let n=new Set;for(let s of e.explicitOrderBy)e.le.push(s),n.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ae(pe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.le.push(new Ft(s,r))}),n.has(pe.keyField().canonicalString())||e.le.push(new Ft(pe.keyField(),r))}return e.le}function xe(t){let e=R(t);return e.he||(e.he=cv(e,Er(t))),e.he}function cv(t,e){if(t.limitType==="F")return uf(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Ft(i.field,s)});let n=t.endAt?new En(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new En(t.startAt.position,t.startAt.inclusive):null;return uf(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function _c(t,e){let n=t.filters.concat([e]);return new ht(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function yc(t,e,n){return new ht(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ds(t,e){return Mu(xe(t),xe(e))&&t.limitType===e.limitType}function jf(t){return`${Lu(xe(t))}|lt:${t.limitType}`}function hn(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>qf(i)).join(", ")}]`),Cs(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>vn(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>vn(i)).join(",")),`Target(${r})`}(xe(t))}; limitType=${t.limitType})`}function ks(t,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):E.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(let s of Er(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){let u=af(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,Er(r),i)||r.endAt&&!function(o,a,c){let u=af(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,Er(r),i))}(t,e)}function uv(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Gf(t){return(e,n)=>{let r=!1;for(let i of Er(t)){let s=lv(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function lv(t,e,n){let r=t.field.isKeyField()?E.comparator(e.key,n.key):function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?In(c,u):S()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var dt=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){zt(this.inner,(n,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return Vf(this.inner)}size(){return this.innerSize}};var hv=new $(E.comparator);function Qe(){return hv}var Wf=new $(E.comparator);function Ir(...t){let e=Wf;for(let n of t)e=e.insert(n.key,n);return e}function Kf(t){let e=Wf;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function kt(){return wr()}function Hf(){return wr()}function wr(){return new dt(t=>t.toString(),(t,e)=>t.isEqual(e))}var dv=new $(E.comparator),fv=new ae(E.comparator);function D(...t){let e=fv;for(let n of t)e=e.add(n);return e}var pv=new ae(O);function mv(){return pv}function Qf(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ar(e)?"-0":e}}function Yf(t){return{integerValue:""+t}}function gv(t,e){return ev(e)?Yf(e):Qf(t,e)}var wn=class{constructor(){this._=void 0}};function _v(t,e,n){return t instanceof Tn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ou(s)&&(s=xu(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof Ut?Xf(t,e):t instanceof Bt?Zf(t,e):function(i,s){let o=Jf(i,s),a=hf(o)+hf(i.Ie);return oc(o)&&oc(i.Ie)?Yf(a):Qf(i.serializer,a)}(t,e)}function yv(t,e,n){return t instanceof Ut?Xf(t,e):t instanceof Bt?Zf(t,e):n}function Jf(t,e){return t instanceof An?function(r){return oc(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Tn=class extends wn{},Ut=class extends wn{constructor(e){super(),this.elements=e}};function Xf(t,e){let n=ep(e);for(let r of t.elements)n.some(i=>Me(i,r))||n.push(r);return{arrayValue:{values:n}}}var Bt=class extends wn{constructor(e){super(),this.elements=e}};function Zf(t,e){let n=ep(e);for(let r of t.elements)n=n.filter(i=>!Me(i,r));return{arrayValue:{values:n}}}var An=class extends wn{constructor(e,n){super(),this.serializer=e,this.Ie=n}};function hf(t){return q(t.integerValue||t.doubleValue)}function ep(t){return Vu(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Iv(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof Ut&&i instanceof Ut||r instanceof Bt&&i instanceof Bt?yn(r.elements,i.elements,Me):r instanceof An&&i instanceof An?Me(r.Ie,i.Ie):r instanceof Tn&&i instanceof Tn}(t.transform,e.transform)}var Ic=class{constructor(e,n){this.version=e,this.transformResults=n}},Ke=class t{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new t}static exists(e){return new t(void 0,e)}static updateTime(e){return new t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Yi(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var Sn=class{};function tp(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Rr(t.key,Ke.none()):new qt(t.key,t.data,Ke.none());{let n=t.data,r=fe.empty(),i=new ae(pe.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Fe(t.key,r,new ye(i.toArray()),Ke.none())}}function vv(t,e,n){t instanceof qt?function(i,s,o){let a=i.value.clone(),c=ff(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Fe?function(i,s,o){if(!Yi(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=ff(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(np(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Tr(t,e,n,r){return t instanceof qt?function(s,o,a,c){if(!Yi(s.precondition,o))return a;let u=s.value.clone(),l=pf(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Fe?function(s,o,a,c){if(!Yi(s.precondition,o))return a;let u=pf(s.fieldTransforms,c,o),l=o.data;return l.setAll(np(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,r):function(s,o,a){return Yi(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function Ev(t,e){let n=null;for(let r of t.fieldTransforms){let i=e.data.field(r.field),s=Jf(r.transform,i||null);s!=null&&(n===null&&(n=fe.empty()),n.set(r.field,s))}return n||null}function df(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&yn(r,i,(s,o)=>Iv(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var qt=class extends Sn{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Fe=class extends Sn{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function np(t){let e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=t.data.field(n);e.set(n,r)}}),e}function ff(t,e,n){let r=new Map;V(t.length===n.length);for(let i=0;i<n.length;i++){let s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,yv(o,a,n[i]))}return r}function pf(t,e,n){let r=new Map;for(let i of t){let s=i.transform,o=n.data.field(i.field);r.set(i.field,_v(s,o,e))}return r}var Rr=class extends Sn{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},vc=class extends Sn{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ec=class{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&vv(s,e,r[i])}}applyToLocalView(e,n){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(n=Tr(r,e,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(n=Tr(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){let r=Hf();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let c=tp(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(P.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),D())}isEqual(e){return this.batchId===e.batchId&&yn(this.mutations,e.mutations,(n,r)=>df(n,r))&&yn(this.baseMutations,e.baseMutations,(n,r)=>df(n,r))}},wc=class t{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){V(e.mutations.length===r.length);let i=function(){return dv}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new t(e,n,r,i)}};var Tc=class{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ac=class{constructor(e,n){this.count=e,this.unchangedNames=n}};var G,k;function wv(t){switch(t){default:return S();case p.CANCELLED:case p.UNKNOWN:case p.DEADLINE_EXCEEDED:case p.RESOURCE_EXHAUSTED:case p.INTERNAL:case p.UNAVAILABLE:case p.UNAUTHENTICATED:return!1;case p.INVALID_ARGUMENT:case p.NOT_FOUND:case p.ALREADY_EXISTS:case p.PERMISSION_DENIED:case p.FAILED_PRECONDITION:case p.ABORTED:case p.OUT_OF_RANGE:case p.UNIMPLEMENTED:case p.DATA_LOSS:return!0}}function rp(t){if(t===void 0)return Le("GRPC error has no .code"),p.UNKNOWN;switch(t){case G.OK:return p.OK;case G.CANCELLED:return p.CANCELLED;case G.UNKNOWN:return p.UNKNOWN;case G.DEADLINE_EXCEEDED:return p.DEADLINE_EXCEEDED;case G.RESOURCE_EXHAUSTED:return p.RESOURCE_EXHAUSTED;case G.INTERNAL:return p.INTERNAL;case G.UNAVAILABLE:return p.UNAVAILABLE;case G.UNAUTHENTICATED:return p.UNAUTHENTICATED;case G.INVALID_ARGUMENT:return p.INVALID_ARGUMENT;case G.NOT_FOUND:return p.NOT_FOUND;case G.ALREADY_EXISTS:return p.ALREADY_EXISTS;case G.PERMISSION_DENIED:return p.PERMISSION_DENIED;case G.FAILED_PRECONDITION:return p.FAILED_PRECONDITION;case G.ABORTED:return p.ABORTED;case G.OUT_OF_RANGE:return p.OUT_OF_RANGE;case G.UNIMPLEMENTED:return p.UNIMPLEMENTED;case G.DATA_LOSS:return p.DATA_LOSS;default:return S()}}(k=G||(G={}))[k.OK=0]="OK",k[k.CANCELLED=1]="CANCELLED",k[k.UNKNOWN=2]="UNKNOWN",k[k.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",k[k.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",k[k.NOT_FOUND=5]="NOT_FOUND",k[k.ALREADY_EXISTS=6]="ALREADY_EXISTS",k[k.PERMISSION_DENIED=7]="PERMISSION_DENIED",k[k.UNAUTHENTICATED=16]="UNAUTHENTICATED",k[k.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",k[k.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",k[k.ABORTED=10]="ABORTED",k[k.OUT_OF_RANGE=11]="OUT_OF_RANGE",k[k.UNIMPLEMENTED=12]="UNIMPLEMENTED",k[k.INTERNAL=13]="INTERNAL",k[k.UNAVAILABLE=14]="UNAVAILABLE",k[k.DATA_LOSS=15]="DATA_LOSS";var mf=null;function Tv(){return new TextEncoder}var Av=new Ct([4294967295,4294967295],0);function gf(t){let e=Tv().encode(t),n=new Xd;return n.update(e),new Uint8Array(n.digest())}function _f(t){let e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ct([n,r],0),new Ct([i,s],0)]}var Sc=class t{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Nt(`Invalid padding: ${n}`);if(r<0)throw new Nt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Nt(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Nt(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ee=Ct.fromNumber(this.Te)}de(e,n,r){let i=e.add(n.multiply(Ct.fromNumber(r)));return i.compare(Av)===1&&(i=new Ct([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let n=gf(e),[r,i]=_f(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,n,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new t(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let n=gf(e),[r,i]=_f(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}},Nt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ss=class t{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){let i=new Map;return i.set(e,Pr.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new t(P.min(),i,new $(O),Qe(),D())}},Pr=class t{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new t(r,n,D(),D(),D())}};var mn=class{constructor(e,n,r,i){this.Ve=e,this.removedTargetIds=n,this.key=r,this.me=i}},os=class{constructor(e,n){this.targetId=e,this.fe=n}},as=class{constructor(e,n,r=ue.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}},cs=class{constructor(){this.ge=0,this.pe=If(),this.ye=ue.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=D(),n=D(),r=D();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:S()}}),new Pr(this.ye,this.we,e,n,r)}Fe(){this.Se=!1,this.pe=If()}Me(e,n){this.Se=!0,this.pe=this.pe.insert(e,n)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,V(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},bc=class{constructor(e){this.Be=e,this.ke=new Map,this.qe=Qe(),this.Qe=yf(),this.Ke=new $(O)}$e(e){for(let n of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(n,e.me):this.We(n,e.key,e.me);for(let n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(e){this.forEachTarget(e,n=>{let r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(e.resumeToken));break;default:S()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ke.forEach((r,i)=>{this.je(i)&&n(i)})}Je(e){let n=e.targetId,r=e.fe.count,i=this.Ye(n);if(i){let s=i.target;if(gc(s))if(r===0){let o=new E(s.path);this.We(n,o,we.newNoDocument(o,P.min()))}else V(r===1);else{let o=this.Ze(n);if(o!==r){let a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(n);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}mf?.tt(function(l,d,f,m,w){var T,v,N,M,z,re;let Ae={localCacheCount:l,existenceFilterCount:d.count,databaseId:f.database,projectId:f.projectId},Q=d.unchangedNames;return Q&&(Ae.bloomFilter={applied:w===0,hashCount:(T=Q?.hashCount)!==null&&T!==void 0?T:0,bitmapLength:(M=(N=(v=Q?.bits)===null||v===void 0?void 0:v.bitmap)===null||N===void 0?void 0:N.length)!==null&&M!==void 0?M:0,padding:(re=(z=Q?.bits)===null||z===void 0?void 0:z.padding)!==null&&re!==void 0?re:0,mightContain:Ue=>{var Gt;return(Gt=m?.mightContain(Ue))!==null&&Gt!==void 0&&Gt}}),Ae}(o,e.fe,this.Be.nt(),a,c))}}}}Xe(e){let n=e.fe.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n,o,a;try{o=lt(r).toUint8Array()}catch(c){if(c instanceof ns)return _n("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Sc(o,i,s)}catch(c){return _n(c instanceof Nt?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,n,r){return n.fe.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){let r=this.Be.getRemoteKeysForTarget(n),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(n,s,null),i++)}),i}it(e){let n=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&gc(a.target)){let c=new E(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,we.newNoDocument(c,e))}s.De&&(n.set(o,s.ve()),s.Fe())}});let r=D();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new ss(e,n,this.Ke,this.qe,r);return this.qe=Qe(),this.Qe=yf(),this.Ke=new $(O),i}Ue(e,n){if(!this.je(e))return;let r=this.st(e,n.key)?2:0;this.ze(e).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(e))}We(e,n,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,n)?i.Me(n,1):i.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(e)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let n=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let n=this.ke.get(e);return n||(n=new cs,this.ke.set(e,n)),n}ot(e){let n=this.Qe.get(e);return n||(n=new ae(O),this.Qe=this.Qe.insert(e,n)),n}je(e){let n=this.Ye(e)!==null;return n||y("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){let n=this.ke.get(e);return n&&n.be?null:this.Be._t(e)}He(e){this.ke.set(e,new cs),this.Be.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}st(e,n){return this.Be.getRemoteKeysForTarget(e).has(n)}};function yf(){return new $(E.comparator)}function If(){return new $(E.comparator)}var Sv={asc:"ASCENDING",desc:"DESCENDING"},bv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rv={and:"AND",or:"OR"},Rc=class{constructor(e,n){this.databaseId=e,this.useProto3Json=n}};function Pc(t,e){return t.useProto3Json||Cs(e)?e:{value:e}}function us(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ip(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Pv(t,e){return us(t,e.toTimestamp())}function Ve(t){return V(!!t),P.fromTimestamp(function(n){let r=He(n);return new ne(r.seconds,r.nanos)}(t))}function Uu(t,e){return Cc(t,e).canonicalString()}function Cc(t,e){let n=function(i){return new F(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function sp(t){let e=F.fromString(t);return V(lp(e)),e}function Dc(t,e){return Uu(t.databaseId,e.path)}function $a(t,e){let n=sp(e);if(n.get(1)!==t.databaseId.projectId)throw new I(p.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new I(p.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new E(ap(n))}function op(t,e){return Uu(t.databaseId,e)}function Cv(t){let e=sp(t);return e.length===4?F.emptyPath():ap(e)}function kc(t){return new F(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ap(t){return V(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function vf(t,e,n){return{name:Dc(t,e),fields:n.value.mapValue.fields}}function Dv(t,e){let n;if("targetChange"in e){e.targetChange;let r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(V(l===void 0||typeof l=="string"),ue.fromBase64String(l||"")):(V(l===void 0||l instanceof Buffer||l instanceof Uint8Array),ue.fromUint8Array(l||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let l=u.code===void 0?p.UNKNOWN:rp(u.code);return new I(l,u.message||"")}(o);n=new as(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=$a(t,r.document.name),s=Ve(r.document.updateTime),o=r.document.createTime?Ve(r.document.createTime):P.min(),a=new fe({mapValue:{fields:r.document.fields}}),c=we.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new mn(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=$a(t,r.document),s=r.readTime?Ve(r.readTime):P.min(),o=we.newNoDocument(i,s),a=r.removedTargetIds||[];n=new mn([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=$a(t,r.document),s=r.removedTargetIds||[];n=new mn([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Ac(i,s),a=r.targetId;n=new os(a,o)}}return n}function kv(t,e){let n;if(e instanceof qt)n={update:vf(t,e.key,e.value)};else if(e instanceof Rr)n={delete:Dc(t,e.key)};else if(e instanceof Fe)n={update:vf(t,e.key,e.data),updateMask:Bv(e.fieldMask)};else{if(!(e instanceof vc))return S();n={verify:Dc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Tn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ut)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Bt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof An)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw S()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Pv(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(t,e.precondition)),n}function Nv(t,e){return t&&t.length>0?(V(e!==void 0),t.map(n=>function(i,s){let o=i.updateTime?Ve(i.updateTime):Ve(s);return o.isEqual(P.min())&&(o=Ve(s)),new Ic(o,i.transformResults||[])}(n,e))):[]}function Ov(t,e){return{documents:[op(t,e.path)]}}function xv(t,e){let n={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=op(t,i);let s=function(u){if(u.length!==0)return up(Te.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);let o=function(u){if(u.length!==0)return u.map(l=>function(f){return{field:dn(f.field),direction:Mv(f.dir)}}(l))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);let a=Pc(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ut:n,parent:i}}function Vv(t){let e=Cv(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){V(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];n.where&&(s=function(d){let f=cp(d);return f instanceof Te&&Uf(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(d){return d.map(f=>function(w){return new Ft(fn(w.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,Cs(f)?null:f}(n.limit));let c=null;n.startAt&&(c=function(d){let f=!!d.before,m=d.values||[];return new En(m,f)}(n.startAt));let u=null;return n.endAt&&(u=function(d){let f=!d.before,m=d.values||[];return new En(m,f)}(n.endAt)),av(e,i,o,s,a,"F",c,u)}function Lv(t,e){let n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function cp(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=fn(n.unaryFilter.field);return K.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=fn(n.unaryFilter.field);return K.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=fn(n.unaryFilter.field);return K.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=fn(n.unaryFilter.field);return K.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(t):t.fieldFilter!==void 0?function(n){return K.create(fn(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Te.create(n.compositeFilter.filters.map(r=>cp(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(n.compositeFilter.op))}(t):S()}function Mv(t){return Sv[t]}function Fv(t){return bv[t]}function Uv(t){return Rv[t]}function dn(t){return{fieldPath:t.canonicalString()}}function fn(t){return pe.fromServerFormat(t.fieldPath)}function up(t){return t instanceof K?function(n){if(n.op==="=="){if(of(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NAN"}};if(sf(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(of(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NOT_NAN"}};if(sf(n.value))return{unaryFilter:{field:dn(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(n.field),op:Fv(n.op),value:n.value}}}(t):t instanceof Te?function(n){let r=n.getFilters().map(i=>up(i));return r.length===1?r[0]:{compositeFilter:{op:Uv(n.op),filters:r}}}(t):S()}function Bv(t){let e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function lp(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}var Cr=class t{constructor(e,n,r,i,s=P.min(),o=P.min(),a=ue.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Nc=class{constructor(e){this.ct=e}};function qv(t){let e=Vv({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?yc(e,e.limit,"L"):e}var ls=class{constructor(){}Pt(e,n){this.It(e,n),n.Tt()}It(e,n){if("nullValue"in e)this.Et(n,5);else if("booleanValue"in e)this.Et(n,10),n.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(n,15),n.dt(q(e.integerValue));else if("doubleValue"in e){let r=q(e.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),Ar(r)?n.dt(0):n.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(n,20),typeof r=="string"&&(r=He(r)),n.At(`${r.seconds||""}`),n.dt(r.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,n),this.Vt(n);else if("bytesValue"in e)this.Et(n,30),n.ft(lt(e.bytesValue)),this.Vt(n);else if("referenceValue"in e)this.gt(e.referenceValue,n);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in e?Lf(e)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,n),this.Vt(n)):"arrayValue"in e?(this.wt(e.arrayValue,n),this.Vt(n)):S()}Rt(e,n){this.Et(n,25),this.St(e,n)}St(e,n){n.At(e)}yt(e,n){let r=e.fields||{};this.Et(n,55);for(let i of Object.keys(r))this.Rt(i,n),this.It(r[i],n)}wt(e,n){let r=e.values||[];this.Et(n,50);for(let i of r)this.It(i,n)}gt(e,n){this.Et(n,37),E.fromName(e).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(e,n){e.dt(n)}Vt(e){e.dt(2)}};ls.bt=new ls;var Oc=class{constructor(){this._n=new xc}addToCollectionParentIndex(e,n){return this._n.add(n),g.resolve()}getCollectionParents(e,n){return g.resolve(this._n.getEntries(n))}addFieldIndex(e,n){return g.resolve()}deleteFieldIndex(e,n){return g.resolve()}deleteAllFieldIndexes(e){return g.resolve()}createTargetIndexes(e,n){return g.resolve()}getDocumentsMatchingTarget(e,n){return g.resolve(null)}getIndexType(e,n){return g.resolve(0)}getFieldIndexes(e,n){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,n){return g.resolve(Lt.min())}getMinOffsetFromCollectionGroup(e,n){return g.resolve(Lt.min())}updateCollectionGroup(e,n,r){return g.resolve()}updateIndexEntries(e,n){return g.resolve()}},xc=class{constructor(){this.index={}}add(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new ae(F.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ae(F.comparator)).toArray()}};var zT=new Uint8Array(0);var ke=class t{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(41943040,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);var Dr=class t{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new t(0)}static Ln(){return new t(-1)}};var Vc=class{constructor(){this.changes=new dt(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,we.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?g.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Lc=class{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}};var Mc=class{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Tr(r.mutation,i,ye.empty(),ne.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,D()).next(()=>r))}getLocalViewOfDocuments(e,n,r=D()){let i=kt();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=Ir();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){let r=kt();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,D()))}populateOverlays(e,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Qe(),o=wr(),a=function(){return wr()}();return n.forEach((c,u)=>{let l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof Fe)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),Tr(l.mutation,u,l.mutation.getFieldMask(),ne.now())):o.set(u.key,ye.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),n.forEach((u,l)=>{var d;return a.set(u,new Lc(l,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){let r=wr(),i=new $((o,a)=>o-a),s=D();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=n.get(c);if(u===null)return;let l=r.get(c)||ye.empty();l=a.applyToLocalView(u,l),r.set(c,l);let d=(i.get(a.batchId)||D()).add(c);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,l=c.value,d=Hf();l.forEach(f=>{if(!s.has(f)){let m=tp(n.get(f),r.get(f));m!==null&&d.set(f,m),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return g.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return E.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):zf(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):g.resolve(kt()),a=-1,c=s;return o.next(u=>g.forEach(u,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(l)?g.resolve():this.remoteDocumentCache.getEntry(e,l).next(f=>{c=c.insert(l,f)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,D())).next(l=>({batchId:a,changes:Kf(l)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new E(n)).next(r=>{let i=Ir();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){let s=n.collectionGroup,o=Ir();return this.indexManager.getCollectionParents(e,s).next(a=>g.forEach(a,c=>{let u=function(d,f){return new ht(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(l=>{l.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((c,u)=>{let l=u.getKey();o.get(l)===null&&(o=o.insert(l,we.newInvalidDocument(l)))});let a=Ir();return o.forEach((c,u)=>{let l=s.get(c);l!==void 0&&Tr(l.mutation,u,ye.empty(),ne.now()),ks(n,u)&&(a=a.insert(c,u))}),a})}};var Fc=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,n){return g.resolve(this.cr.get(n))}saveBundleMetadata(e,n){return this.cr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Ve(i.createTime)}}(n)),g.resolve()}getNamedQuery(e,n){return g.resolve(this.lr.get(n))}saveNamedQuery(e,n){return this.lr.set(n.name,function(i){return{name:i.name,query:qv(i.bundledQuery),readTime:Ve(i.readTime)}}(n)),g.resolve()}};var Uc=class{constructor(){this.overlays=new $(E.comparator),this.hr=new Map}getOverlay(e,n){return g.resolve(this.overlays.get(n))}getOverlays(e,n){let r=kt();return g.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ht(e,n,s)}),g.resolve()}removeOverlaysForBatchId(e,n,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),g.resolve()}getOverlaysForCollection(e,n,r){let i=kt(),s=n.length+1,o=new E(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return g.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new $((u,l)=>u-l),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=kt(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}let a=kt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return g.resolve(a)}ht(e,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Tc(n,r));let s=this.hr.get(n);s===void 0&&(s=D(),this.hr.set(n,s)),this.hr.set(n,s.add(r.key))}};var kr=class{constructor(){this.Pr=new ae(W.Ir),this.Tr=new ae(W.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,n){let r=new W(e,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Ar(new W(e,n))}Rr(e,n){e.forEach(r=>this.removeReference(r,n))}Vr(e){let n=new E(new F([])),r=new W(n,e),i=new W(n,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let n=new E(new F([])),r=new W(n,e),i=new W(n,e+1),s=D();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let n=new W(e,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}},W=class{constructor(e,n){this.key=e,this.pr=n}static Ir(e,n){return E.comparator(e.key,n.key)||O(e.pr,n.pr)}static Er(e,n){return O(e.pr,n.pr)||E.comparator(e.key,n.key)}};var Bc=class{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new ae(W.Ir)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ec(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new W(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,n){return g.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(e,n){let r=n+1,i=this.br(r),s=i<0?0:i;return g.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){let r=new W(n,0),i=new W(n,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),g.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ae(O);return n.forEach(i=>{let s=new W(i,0),o=new W(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),g.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,i=r.length+1,s=r;E.isDocumentKey(s)||(s=s.child(""));let o=new W(new E(s),0),a=new ae(O);return this.wr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.pr)),!0)},o),g.resolve(this.Dr(a))}Dr(e){let n=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){V(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return g.forEach(n.mutations,i=>{let s=new W(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,n){let r=new W(n,0),i=this.wr.firstAfterOrEqual(r);return g.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}Cr(e,n){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let n=this.br(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var qc=class{constructor(e){this.vr=e,this.docs=function(){return new $(E.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){let r=this.docs.get(n);return g.resolve(r?r.document.mutableCopy():we.newInvalidDocument(n))}getEntries(e,n){let r=Qe();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():we.newInvalidDocument(i))}),g.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Qe(),o=n.path,a=new E(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||XI(JI(l),r)<=0||(i.has(l.key)||ks(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(e,n,r,i){S()}Fr(e,n){return g.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new $c(this)}getSize(e){return g.resolve(this.size)}},$c=class extends Vc{constructor(e){super(),this.ar=e}applyChanges(e){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),g.waitFor(n)}getFromCache(e,n){return this.ar.getEntry(e,n)}getAllFromCache(e,n){return this.ar.getEntries(e,n)}};var zc=class{constructor(e){this.persistence=e,this.Mr=new dt(n=>Lu(n),Mu),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.Or=0,this.Nr=new kr,this.targetCount=0,this.Lr=Dr.Nn()}forEachTarget(e,n){return this.Mr.forEach((r,i)=>n(i)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),g.resolve()}qn(e){this.Mr.set(e.target,e);let n=e.targetId;n>this.highestTargetId&&(this.Lr=new Dr(n),this.highestTargetId=n),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,n){return this.qn(n),this.targetCount+=1,g.resolve()}updateTargetData(e,n){return this.qn(n),g.resolve()}removeTargetData(e,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,n,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),g.waitFor(s).next(()=>i)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,n){let r=this.Mr.get(n)||null;return g.resolve(r)}addMatchingKeys(e,n,r){return this.Nr.dr(n,r),g.resolve()}removeMatchingKeys(e,n,r){this.Nr.Rr(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),g.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Nr.Vr(n),g.resolve()}getMatchingKeysForTargetId(e,n){let r=this.Nr.gr(n);return g.resolve(r)}containsKey(e,n){return g.resolve(this.Nr.containsKey(n))}};var jc=class{constructor(e,n){this.Br={},this.overlays={},this.kr=new xf(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new zc(this),this.indexManager=new Oc,this.remoteDocumentCache=function(i){return new qc(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Nc(n),this.$r=new Fc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Uc,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Br[e.toKey()];return r||(r=new Bc(n,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,n,r){y("MemoryPersistence","Starting transaction:",e);let i=new Gc(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,n){return g.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,n)))}},Gc=class extends ec{constructor(e){super(),this.currentSequenceNumber=e}},Wc=class t{constructor(e){this.persistence=e,this.zr=new kr,this.jr=null}static Hr(e){return new t(e)}get Jr(){if(this.jr)return this.jr;throw S()}addReference(e,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),g.resolve()}removeReference(e,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),g.resolve()}markPotentiallyOrphaned(e,n){return this.Jr.add(n.toString()),g.resolve()}removeTarget(e,n){this.zr.Vr(n.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ur(){this.jr=new Set}Wr(e){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Jr,r=>{let i=E.fromPath(r);return this.Yr(e,i).next(s=>{s||n.removeEntry(i,P.min())})}).next(()=>(this.jr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Yr(e,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(e){return 0}Yr(e,n){return g.or([()=>g.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gr(e,n)])}};var Kc=class t{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.qi=r,this.Qi=i}static Ki(e,n){let r=D(),i=D();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new t(e,n.fromCache,r,i)}};var Hc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Qc=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return vl()?8:es.v(U())>0?6:4}()}initialize(e,n){this.zi=e,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(e,n,r,i){let s={result:null};return this.ji(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Hc;return this.Ji(e,n,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,n,o,a.size)})}).next(()=>s.result)}Yi(e,n,r,i){return r.documentReadCount<this.Wi?(yr()<=C.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",hn(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),g.resolve()):(yr()<=C.DEBUG&&y("QueryEngine","Query:",hn(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(yr()<=C.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",hn(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xe(n))):g.resolve())}ji(e,n){if(lf(n))return g.resolve(null);let r=xe(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=yc(n,null,"F"),r=xe(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=D(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.Zi(n,a);return this.Xi(n,u,o,c.readTime)?this.ji(e,yc(n,null,"F")):this.es(e,u,n,c)}))})))}Hi(e,n,r,i){return lf(n)||i.isEqual(P.min())?g.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(n,s);return this.Xi(n,o,r,i)?g.resolve(null):(yr()<=C.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),hn(n)),this.es(e,o,n,YI(i,-1)).next(a=>a))})}Zi(e,n){let r=new ae(Gf(e));return n.forEach((i,s)=>{ks(e,s)&&(r=r.add(s))}),r}Xi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;let s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,n,r){return yr()<=C.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",hn(n)),this.zi.getDocumentsMatchingQuery(e,n,Lt.min(),r)}es(e,n,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Yc=class{constructor(e,n,r,i){this.persistence=e,this.ts=n,this.serializer=i,this.ns=new $(O),this.rs=new dt(s=>Lu(s),Mu),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Mc(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ns))}};function $v(t,e,n,r){return new Yc(t,e,n,r)}function hp(t,e){return h(this,null,function*(){let n=R(t);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n._s(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=D();for(let u of i){o.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}for(let u of s){a.push(u.batchId);for(let l of u.mutations)c=c.add(l.key)}return n.localDocuments.getDocuments(r,c).next(u=>({us:u,removedBatchIds:o,addedBatchIds:a}))})})})}function zv(t,e){let n=R(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){let d=u.batch,f=d.keys(),m=g.resolve();return f.forEach(w=>{m=m.next(()=>l.getEntry(c,w)).next(T=>{let v=u.docVersions.get(w);V(v!==null),T.version.compareTo(v)<0&&(d.applyToRemoteDocument(T,u),T.isValidDocument()&&(T.setReadTime(u.commitVersion),l.addEntry(T)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(c,d))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=D();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function dp(t){let e=R(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Qr.getLastRemoteSnapshotVersion(n))}function jv(t,e){let n=R(t),r=e.snapshotVersion,i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];e.targetChanges.forEach((l,d)=>{let f=i.get(d);if(!f)return;a.push(n.Qr.removeMatchingKeys(s,l.removedDocuments,d).next(()=>n.Qr.addMatchingKeys(s,l.addedDocuments,d)));let m=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(ue.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):l.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(l.resumeToken,r)),i=i.insert(d,m),function(T,v,N){return T.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0}(f,m,l)&&a.push(n.Qr.updateTargetData(s,m))});let c=Qe(),u=D();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Gv(s,o,e.documentUpdates).next(l=>{c=l.cs,u=l.ls})),!r.isEqual(P.min())){let l=n.Qr.getLastRemoteSnapshotVersion(s).next(d=>n.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return g.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(n.ns=i,s))}function Gv(t,e,n){let r=D(),i=D();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Qe();return n.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(P.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{cs:o,ls:i}})}function Wv(t,e){let n=R(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Kv(t,e){let n=R(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Qr.getTargetData(r,e).next(s=>s?(i=s,g.resolve(i)):n.Qr.allocateTargetId(r).next(o=>(i=new Cr(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=n.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ns=n.ns.insert(r.targetId,r),n.rs.set(e,r.targetId)),r})}function Jc(t,e,n){return h(this,null,function*(){let r=R(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Mr(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function Ef(t,e,n){let r=R(t),i=P.min(),s=D();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){let d=R(c),f=d.rs.get(l);return f!==void 0?g.resolve(d.ns.get(f)):d.Qr.getTargetData(u,l)}(r,o,xe(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,n?i:P.min(),n?s:D())).next(a=>(Hv(r,uv(e),a),{documents:a,hs:s})))}function Hv(t,e,n){let r=t.ss.get(e)||P.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.ss.set(e,r)}var hs=class{constructor(){this.activeTargetIds=mv()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Xc=class{constructor(){this.no=new hs,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,n,r){this.ro[e]=n}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new hs,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Zc=class{io(e){}shutdown(){}};var ds=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Hi=null;function za(){return Hi===null?Hi=function(){return 268435456+Math.round(2147483648*Math.random())}():Hi++,"0x"+Hi.toString(16)}var Qv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var eu=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var oe="WebChannelConnection",tu=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(n,r,i,s,o){let a=za(),c=this.bo(n,r.toUriEncodedString());y("RestConnection",`Sending RPC '${n}' ${a}:`,c,i);let u={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(u,s,o),this.Co(n,c,u,i).then(l=>(y("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw _n("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}vo(n,r,i,s,o,a){return this.So(n,r,i,s,o)}Do(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Cn}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}bo(n,r){let i=Qv[n];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,n,r,i){let s=za();return new Promise((o,a)=>{let c=new Jd;c.setWithCredentials(!0),c.listenOnce(Qd.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Wi.NO_ERROR:let l=c.getResponseJson();y(oe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Wi.TIMEOUT:y(oe,`RPC '${e}' ${s} timed out`),a(new I(p.DEADLINE_EXCEEDED,"Request time out"));break;case Wi.HTTP_ERROR:let d=c.getStatus();if(y(oe,`RPC '${e}' ${s} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);let m=f?.error;if(m&&m.status&&m.message){let w=function(v){let N=v.toLowerCase().replace(/_/g,"-");return Object.values(p).indexOf(N)>=0?N:p.UNKNOWN}(m.status);a(new I(w,m.message))}else a(new I(p.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new I(p.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{y(oe,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(i);y(oe,`RPC '${e}' ${s} sending request:`,i),c.send(n,"POST",u,r,15)})}Fo(e,n,r){let i=za(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Kd(),a=Hd(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;let l=s.join("");y(oe,`Creating RPC '${e}' stream ${i}: ${l}`,c);let d=o.createWebChannel(l,c),f=!1,m=!1,w=new eu({lo:v=>{m?y(oe,`Not sending because RPC '${e}' stream ${i} is closed:`,v):(f||(y(oe,`Opening RPC '${e}' stream ${i} transport.`),d.open(),f=!0),y(oe,`RPC '${e}' stream ${i} sending:`,v),d.send(v))},ho:()=>d.close()}),T=(v,N,M)=>{v.listen(N,z=>{try{M(z)}catch(re){setTimeout(()=>{throw re},0)}})};return T(d,_r.EventType.OPEN,()=>{m||y(oe,`RPC '${e}' stream ${i} transport opened.`)}),T(d,_r.EventType.CLOSE,()=>{m||(m=!0,y(oe,`RPC '${e}' stream ${i} transport closed`),w.Vo())}),T(d,_r.EventType.ERROR,v=>{m||(m=!0,_n(oe,`RPC '${e}' stream ${i} transport errored:`,v),w.Vo(new I(p.UNAVAILABLE,"The operation could not be completed")))}),T(d,_r.EventType.MESSAGE,v=>{var N;if(!m){let M=v.data[0];V(!!M);let z=M,re=z.error||((N=z[0])===null||N===void 0?void 0:N.error);if(re){y(oe,`RPC '${e}' stream ${i} received error:`,re);let Ae=re.status,Q=function(kn){let $r=G[kn];if($r!==void 0)return rp($r)}(Ae),Ue=re.message;Q===void 0&&(Q=p.INTERNAL,Ue="Unknown error status: "+Ae+" with message "+re.message),m=!0,w.Vo(new I(Q,Ue)),d.close()}else y(oe,`RPC '${e}' stream ${i} received:`,M),w.mo(M)}}),T(a,Yd.STAT_EVENT,v=>{v.stat===qa.PROXY?y(oe,`RPC '${e}' stream ${i} detected buffering proxy`):v.stat===qa.NOPROXY&&y(oe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{w.Ro()},0),w}};function ja(){return typeof document<"u"?document:null}function Ns(t){return new Rc(t,!0)}var fs=class{constructor(e,n,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,n-r);i>0&&y("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var ps=class{constructor(e,n,r,i,s,o,a,c){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new fs(e,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return h(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return h(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,n){return h(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():n&&n.code===p.RESOURCE_EXHAUSTED?(Le(n.toString()),Le("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===p.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===n&&this.o_(r,i)},r=>{e(()=>{let i=new I(p.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,n){let r=this.s_(this.Wo);this.stream=this.a_(e,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>h(this,null,function*(){this.state=0,this.start()}))}__(e){return y("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return n=>{this.oi.enqueueAndForget(()=>this.Wo===e?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},nu=class extends ps{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}a_(e,n){return this.connection.Fo("Listen",e,n)}onMessage(e){this.jo.reset();let n=Dv(this.serializer,e),r=function(s){if(!("targetChange"in s))return P.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?P.min():o.readTime?Ve(o.readTime):P.min()}(e);return this.listener.u_(n,r)}c_(e){let n={};n.database=kc(this.serializer),n.addTarget=function(s,o){let a,c=o.target;if(a=gc(c)?{documents:Ov(s,c)}:{query:xv(s,c).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ip(s,o.resumeToken);let u=Pc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(P.min())>0){a.readTime=us(s,o.snapshotVersion.toTimestamp());let u=Pc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let r=Lv(this.serializer,e);r&&(n.labels=r),this.t_(n)}l_(e){let n={};n.database=kc(this.serializer),n.removeTarget=e,this.t_(n)}},ru=class extends ps{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,n){return this.connection.Fo("Write",e,n)}onMessage(e){if(V(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let n=Nv(e.writeResults,e.commitTime),r=Ve(e.commitTime);return this.listener.T_(r,n)}return V(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=kc(this.serializer),this.t_(e)}I_(e){let n={streamToken:this.lastStreamToken,writes:e.map(r=>kv(this.serializer,r))};this.t_(n)}};var iu=class extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new I(p.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,Cc(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new I(p.UNKNOWN,s.toString())})}vo(e,n,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,Cc(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new I(p.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var su=class{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Le(n),this.g_=!1):y("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var ou=class{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>h(this,null,function*(){jt(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(c){return h(this,null,function*(){let u=R(c);u.v_.add(4),yield Fr(u),u.x_.set("Unknown"),u.v_.delete(4),yield Os(u)})}(this))}))}),this.x_=new su(r,i)}};function Os(t){return h(this,null,function*(){if(jt(t))for(let e of t.F_)yield e(!0)})}function Fr(t){return h(this,null,function*(){for(let e of t.F_)yield e(!1)})}function fp(t,e){let n=R(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),zu(n)?$u(n):Dn(n).Jo()&&qu(n,e))}function Bu(t,e){let n=R(t),r=Dn(n);n.C_.delete(e),r.Jo()&&pp(n,e),n.C_.size===0&&(r.Jo()?r.Xo():jt(n)&&n.x_.set("Unknown"))}function qu(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(P.min())>0){let n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Dn(t).c_(e)}function pp(t,e){t.O_.Oe(e),Dn(t).l_(e)}function $u(t){t.O_=new bc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Dn(t).start(),t.x_.p_()}function zu(t){return jt(t)&&!Dn(t).Ho()&&t.C_.size>0}function jt(t){return R(t).v_.size===0}function mp(t){t.O_=void 0}function Yv(t){return h(this,null,function*(){t.C_.forEach((e,n)=>{qu(t,e)})})}function Jv(t,e){return h(this,null,function*(){mp(t),zu(t)?(t.x_.S_(e),$u(t)):t.x_.set("Unknown")})}function Xv(t,e,n){return h(this,null,function*(){if(t.x_.set("Online"),e instanceof as&&e.state===2&&e.cause)try{yield function(i,s){return h(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(t,e)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ms(t,r)}else if(e instanceof mn?t.O_.$e(e):e instanceof os?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(P.min()))try{let r=yield dp(t.localStore);n.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let l=s.C_.get(u);l&&s.C_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let l=s.C_.get(c);if(!l)return;s.C_.set(c,l.withResumeToken(ue.EMPTY_BYTE_STRING,l.snapshotVersion)),pp(s,c);let d=new Cr(l.target,c,u,l.sequenceNumber);qu(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield ms(t,r)}})}function ms(t,e,n){return h(this,null,function*(){if(!Mr(e))throw e;t.v_.add(1),yield Fr(t),t.x_.set("Offline"),n||(n=()=>dp(t.localStore)),t.asyncQueue.enqueueRetryable(()=>h(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield n(),t.v_.delete(1),yield Os(t)}))})}function gp(t,e){return e().catch(n=>ms(t,n,e))}function xs(t){return h(this,null,function*(){let e=R(t),n=ft(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;Zv(e);)try{let i=yield Wv(e.localStore,r);if(i===null){e.D_.length===0&&n.Xo();break}r=i.batchId,eE(e,i)}catch(i){yield ms(e,i)}_p(e)&&yp(e)})}function Zv(t){return jt(t)&&t.D_.length<10}function eE(t,e){t.D_.push(e);let n=ft(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function _p(t){return jt(t)&&!ft(t).Ho()&&t.D_.length>0}function yp(t){ft(t).start()}function tE(t){return h(this,null,function*(){ft(t).d_()})}function nE(t){return h(this,null,function*(){let e=ft(t);for(let n of t.D_)e.I_(n.mutations)})}function rE(t,e,n){return h(this,null,function*(){let r=t.D_.shift(),i=wc.from(r,e,n);yield gp(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),yield xs(t)})}function iE(t,e){return h(this,null,function*(){e&&ft(t).P_&&(yield function(r,i){return h(this,null,function*(){if(function(o){return wv(o)&&o!==p.ABORTED}(i.code)){let s=r.D_.shift();ft(r).Zo(),yield gp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield xs(r)}})}(t,e)),_p(t)&&yp(t)})}function wf(t,e){return h(this,null,function*(){let n=R(t);n.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=jt(n);n.v_.add(3),yield Fr(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),yield Os(n)})}function sE(t,e){return h(this,null,function*(){let n=R(t);e?(n.v_.delete(2),yield Os(n)):e||(n.v_.add(2),yield Fr(n),n.x_.set("Unknown"))})}function Dn(t){return t.N_||(t.N_=function(n,r,i){let s=R(n);return s.R_(),new nu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Po:Yv.bind(null,t),To:Jv.bind(null,t),u_:Xv.bind(null,t)}),t.F_.push(e=>h(this,null,function*(){e?(t.N_.Zo(),zu(t)?$u(t):t.x_.set("Unknown")):(yield t.N_.stop(),mp(t))}))),t.N_}function ft(t){return t.L_||(t.L_=function(n,r,i){let s=R(n);return s.R_(),new ru(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Po:tE.bind(null,t),To:iE.bind(null,t),E_:nE.bind(null,t),T_:rE.bind(null,t)}),t.F_.push(e=>h(this,null,function*(){e?(t.L_.Zo(),yield xs(t)):(yield t.L_.stop(),t.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.L_}var au=class t{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ne,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){let o=Date.now()+r,a=new t(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new I(p.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ju(t,e){if(Le("AsyncQueue",`${e}: ${t}`),Mr(t))return new I(p.UNAVAILABLE,`${e}: ${t}`);throw t}var gs=class t{constructor(e){this.comparator=e?(n,r)=>e(n,r)||E.comparator(n.key,r.key):(n,r)=>E.comparator(n.key,r.key),this.keyedMap=Ir(),this.sortedSet=new $(this.comparator)}static emptySet(e){return new t(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){let n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){let n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){let r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}};var _s=class{constructor(){this.B_=new $(E.comparator)}track(e){let n=e.doc.key,r=this.B_.get(n);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(n,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(n):e.type===1&&r.type===2?this.B_=this.B_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(n,{type:2,doc:e.doc}):S():this.B_=this.B_.insert(n,e)}k_(){let e=[];return this.B_.inorderTraversal((n,r)=>{e.push(r)}),e}},bn=class t{constructor(e,n,r,i,s,o,a,c,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new t(e,n,gs.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ds(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}};var cu=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}},uu=class{constructor(){this.queries=new dt(e=>jf(e),Ds),this.onlineState="Unknown",this.W_=new Set}};function oE(t,e){return h(this,null,function*(){let n=R(t),r=3,i=e.query,s=n.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new cu,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield n.onListen(i,!0);break;case 1:s.q_=yield n.onListen(i,!1);break;case 2:yield n.onFirstRemoteStoreListen(i)}}catch(o){let a=ju(o,`Initialization of query '${hn(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.Q_.push(e),e.G_(n.onlineState),s.q_&&e.z_(s.q_)&&Gu(n)})}function aE(t,e){return h(this,null,function*(){let n=R(t),r=e.query,i=3,s=n.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}})}function cE(t,e){let n=R(t),r=!1;for(let i of e){let s=i.query,o=n.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&Gu(n)}function uE(t,e,n){let r=R(t),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(n);r.queries.delete(e)}function Gu(t){t.W_.forEach(e=>{e.next()})}var lu,Tf;(Tf=lu||(lu={})).j_="default",Tf.Cache="cache";var hu=class{constructor(e,n,r){this.query=e,this.H_=n,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new bn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),n=!0):this.X_(e,this.onlineState)&&(this.ea(e),n=!0),this.Y_=e,n}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let n=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),n=!0),n}X_(e,n){if(!e.fromCache||!this.U_())return!0;let r=n!=="Offline";return(!this.options.ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Z_(e){if(e.docChanges.length>0)return!0;let n=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ea(e){e=bn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==lu.Cache}};var ys=class{constructor(e){this.key=e}},Is=class{constructor(e){this.key=e}},du=class{constructor(e,n){this.query=e,this.ua=n,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=D(),this.mutatedKeys=D(),this.ha=Gf(e),this.Pa=new gs(this.ha)}get Ia(){return this.ua}Ta(e,n){let r=n?n.Ea:new _s,i=n?n.Pa:this.Pa,s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,d)=>{let f=i.get(l),m=ks(this.query,d)?d:null,w=!!f&&this.mutatedKeys.has(f.key),T=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),v=!1;f&&m?f.data.isEqual(m.data)?w!==T&&(r.track({type:3,doc:m}),v=!0):this.da(f,m)||(r.track({type:2,doc:m}),v=!0,(c&&this.ha(m,c)>0||u&&this.ha(m,u)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),v=!0):f&&!m&&(r.track({type:1,doc:f}),v=!0,(c||u)&&(a=!0)),v&&(m?(o=o.add(m),s=T?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){let s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;let o=e.Ea.k_();o.sort((l,d)=>function(m,w){let T=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return T(m)-T(w)}(l.type,d.type)||this.ha(l.doc,d.doc)),this.Aa(r),i=i!=null&&i;let a=n&&!i?this.Ra():[],c=this.la.size===0&&this.current&&!i?1:0,u=c!==this.ca;return this.ca=c,o.length!==0||u?{snapshot:new bn(this.query,e.Pa,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new _s,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(n=>this.ua=this.ua.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.ua=this.ua.delete(n)),this.current=e.current)}Ra(){if(!this.current)return[];let e=this.la;this.la=D(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let n=[];return e.forEach(r=>{this.la.has(r)||n.push(new Is(r))}),this.la.forEach(r=>{e.has(r)||n.push(new ys(r))}),n}fa(e){this.ua=e.hs,this.la=D();let n=this.Ta(e.documents);return this.applyChanges(n,!0)}ga(){return bn.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},fu=class{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}},pu=class{constructor(e){this.key=e,this.pa=!1}},mu=class{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new dt(a=>jf(a),Ds),this.Sa=new Map,this.ba=new Set,this.Da=new $(E.comparator),this.Ca=new Map,this.va=new kr,this.Fa={},this.Ma=new Map,this.xa=Dr.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function lE(t,e,n=!0){return h(this,null,function*(){let r=Ap(t),i,s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield Ip(r,e,n,!0),i})}function hE(t,e){return h(this,null,function*(){let n=Ap(t);yield Ip(n,e,!0,!1)})}function Ip(t,e,n,r){return h(this,null,function*(){let i=yield Kv(t.localStore,xe(e)),s=i.targetId,o=n?t.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield dE(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&fp(t.remoteStore,i),a})}function dE(t,e,n,r,i){return h(this,null,function*(){t.Na=(d,f,m)=>function(T,v,N,M){return h(this,null,function*(){let z=v.view.Ta(N);z.Xi&&(z=yield Ef(T.localStore,v.query,!1).then(({documents:Ue})=>v.view.Ta(Ue,z)));let re=M&&M.targetChanges.get(v.targetId),Ae=M&&M.targetMismatches.get(v.targetId)!=null,Q=v.view.applyChanges(z,T.isPrimaryClient,re,Ae);return Sf(T,v.targetId,Q.Va),Q.snapshot})}(t,d,f,m);let s=yield Ef(t.localStore,e,!0),o=new du(e,s.hs),a=o.Ta(s.documents),c=Pr.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,c);Sf(t,n,u.Va);let l=new fu(e,n,o);return t.wa.set(e,l),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),u.snapshot})}function fE(t,e,n){return h(this,null,function*(){let r=R(t),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Ds(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Jc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Bu(r.remoteStore,i.targetId),gu(r,i.targetId)}).catch(Lr))):(gu(r,i.targetId),yield Jc(r.localStore,i.targetId,!0))})}function pE(t,e){return h(this,null,function*(){let n=R(t),r=n.wa.get(e),i=n.Sa.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Bu(n.remoteStore,r.targetId))})}function mE(t,e,n){return h(this,null,function*(){let r=wE(t);try{let i=yield function(o,a){let c=R(o),u=ne.now(),l=a.reduce((m,w)=>m.add(w.key),D()),d,f;return c.persistence.runTransaction("Locally write mutations","readwrite",m=>{let w=Qe(),T=D();return c.os.getEntries(m,l).next(v=>{w=v,w.forEach((N,M)=>{M.isValidDocument()||(T=T.add(N))})}).next(()=>c.localDocuments.getOverlayedDocuments(m,w)).next(v=>{d=v;let N=[];for(let M of a){let z=Ev(M,d.get(M.key).overlayedDocument);z!=null&&N.push(new Fe(M.key,z,Mf(z.value.mapValue),Ke.exists(!0)))}return c.mutationQueue.addMutationBatch(m,u,N,a)}).next(v=>{f=v;let N=v.applyToLocalDocumentSet(d,T);return c.documentOverlayCache.saveOverlays(m,v.batchId,N)})}).then(()=>({batchId:f.batchId,changes:Kf(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Fa[o.currentUser.toKey()];u||(u=new $(O)),u=u.insert(a,c),o.Fa[o.currentUser.toKey()]=u}(r,i.batchId,n),yield Ur(r,i.changes),yield xs(r.remoteStore)}catch(i){let s=ju(i,"Failed to persist write");n.reject(s)}})}function vp(t,e){return h(this,null,function*(){let n=R(t);try{let r=yield jv(n.localStore,e);e.targetChanges.forEach((i,s)=>{let o=n.Ca.get(s);o&&(V(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?V(o.pa):i.removedDocuments.size>0&&(V(o.pa),o.pa=!1))}),yield Ur(n,r,e)}catch(r){yield Lr(r)}})}function Af(t,e,n){let r=R(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let c=R(o);c.onlineState=a;let u=!1;c.queries.forEach((l,d)=>{for(let f of d.Q_)f.G_(a)&&(u=!0)}),u&&Gu(c)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function gE(t,e,n){return h(this,null,function*(){let r=R(t);r.sharedClientState.updateQueryState(e,"rejected",n);let i=r.Ca.get(e),s=i&&i.key;if(s){let o=new $(E.comparator);o=o.insert(s,we.newNoDocument(s,P.min()));let a=D().add(s),c=new ss(P.min(),new Map,new $(O),o,a);yield vp(r,c),r.Da=r.Da.remove(s),r.Ca.delete(e),Wu(r)}else yield Jc(r.localStore,e,!1).then(()=>gu(r,e,n)).catch(Lr)})}function _E(t,e){return h(this,null,function*(){let n=R(t),r=e.batch.batchId;try{let i=yield zv(n.localStore,e);wp(n,r,null),Ep(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Ur(n,i)}catch(i){yield Lr(i)}})}function yE(t,e,n){return h(this,null,function*(){let r=R(t);try{let i=yield function(o,a){let c=R(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(d=>(V(d!==null),l=d.keys(),c.mutationQueue.removeMutationBatch(u,d))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,e);wp(r,e,n),Ep(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),yield Ur(r,i)}catch(i){yield Lr(i)}})}function Ep(t,e){(t.Ma.get(e)||[]).forEach(n=>{n.resolve()}),t.Ma.delete(e)}function wp(t,e,n){let r=R(t),i=r.Fa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function gu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(let r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach(r=>{t.va.containsKey(r)||Tp(t,r)})}function Tp(t,e){t.ba.delete(e.path.canonicalString());let n=t.Da.get(e);n!==null&&(Bu(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),Wu(t))}function Sf(t,e,n){for(let r of n)r instanceof ys?(t.va.addReference(r.key,e),IE(t,r)):r instanceof Is?(y("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||Tp(t,r.key)):S()}function IE(t,e){let n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(y("SyncEngine","New document in limbo: "+n),t.ba.add(r),Wu(t))}function Wu(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){let e=t.ba.values().next().value;t.ba.delete(e);let n=new E(F.fromString(e)),r=t.xa.next();t.Ca.set(r,new pu(n)),t.Da=t.Da.insert(n,r),fp(t.remoteStore,new Cr(xe(Fu(n.path)),r,"TargetPurposeLimboResolution",xf._e))}}function Ur(t,e,n){return h(this,null,function*(){let r=R(t),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,c)=>{o.push(r.Na(c,e,n).then(u=>{if((u||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u?.fromCache?"not-current":"current"),u){i.push(u);let l=Kc.Ki(c.targetId,u);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(c,u){return h(this,null,function*(){let l=R(c);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>g.forEach(u,f=>g.forEach(f.qi,m=>l.persistence.referenceDelegate.addReference(d,f.targetId,m)).next(()=>g.forEach(f.Qi,m=>l.persistence.referenceDelegate.removeReference(d,f.targetId,m)))))}catch(d){if(!Mr(d))throw d;y("LocalStore","Failed to update sequence numbers: "+d)}for(let d of u){let f=d.targetId;if(!d.fromCache){let m=l.ns.get(f),w=m.snapshotVersion,T=m.withLastLimboFreeSnapshotVersion(w);l.ns=l.ns.insert(f,T)}}})}(r.localStore,s))})}function vE(t,e){return h(this,null,function*(){let n=R(t);if(!n.currentUser.isEqual(e)){y("SyncEngine","User change. New user:",e.toKey());let r=yield hp(n.localStore,e);n.currentUser=e,function(s,o){s.Ma.forEach(a=>{a.forEach(c=>{c.reject(new I(p.CANCELLED,o))})}),s.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ur(n,r.us)}})}function EE(t,e){let n=R(t),r=n.Ca.get(e);if(r&&r.pa)return D().add(r.key);{let i=D(),s=n.Sa.get(e);if(!s)return i;for(let o of s){let a=n.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function Ap(t){let e=R(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=vp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=EE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gE.bind(null,e),e.ya.u_=cE.bind(null,e.eventManager),e.ya.La=uE.bind(null,e.eventManager),e}function wE(t){let e=R(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_E.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yE.bind(null,e),e}var vs=class{constructor(){this.synchronizeTabs=!1}initialize(e){return h(this,null,function*(){this.serializer=Ns(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return $v(this.persistence,new Qc,e.initialUser,this.serializer)}createPersistence(e){return new jc(Wc.Hr,this.serializer)}createSharedClientState(e){return new Xc}terminate(){return h(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var _u=class{initialize(e,n){return h(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Af(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=vE.bind(null,this.syncEngine),yield sE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new uu}()}createDatastore(e){let n=Ns(e.databaseInfo.databaseId),r=function(s){return new tu(s)}(e.databaseInfo);return function(s,o,a,c){return new iu(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new ou(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Af(this.syncEngine,n,0),function(){return ds.D()?new ds:new Zc}())}createSyncEngine(e,n){return function(i,s,o,a,c,u,l){let d=new mu(i,s,o,a,c,u);return l&&(d.Oa=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return h(this,null,function*(){var e;yield function(r){return h(this,null,function*(){let i=R(r);y("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield Fr(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var yu=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Le("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}};var Iu=class{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=X.UNAUTHENTICATED,this.clientId=Xi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>h(this,null,function*(){y("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(y("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new I(p.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ne;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>h(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let r=ju(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ga(t,e){return h(this,null,function*(){t.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let n=t.configuration;yield e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(i=>h(this,null,function*(){r.isEqual(i)||(yield hp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e})}function bf(t,e){return h(this,null,function*(){t.asyncQueue.verifyOperationInProgress();let n=yield AE(t);y("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>wf(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>wf(e.remoteStore,i)),t._onlineComponents=e})}function TE(t){return t.name==="FirebaseError"?t.code===p.FAILED_PRECONDITION||t.code===p.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}function AE(t){return h(this,null,function*(){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ga(t,t._uninitializedComponentsProvider._offline)}catch(e){let n=e;if(!TE(n))throw n;_n("Error using user provided cache. Falling back to memory cache: "+n),yield Ga(t,new vs)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield Ga(t,new vs);return t._offlineComponents})}function Sp(t){return h(this,null,function*(){return t._onlineComponents||(t._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield bf(t,t._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield bf(t,new _u))),t._onlineComponents})}function SE(t){return Sp(t).then(e=>e.syncEngine)}function Rf(t){return h(this,null,function*(){let e=yield Sp(t),n=e.eventManager;return n.onListen=lE.bind(null,e.syncEngine),n.onUnlisten=fE.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=hE.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=pE.bind(null,e.syncEngine),n})}function bp(t){let e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}var Pf=new Map;function Rp(t,e,n){if(!n)throw new I(p.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function bE(t,e,n,r){if(e===!0&&r===!0)throw new I(p.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Cf(t){if(!E.isDocumentKey(t))throw new I(p.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Df(t){if(E.isDocumentKey(t))throw new I(p.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Vs(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":S()}function ct(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new I(p.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=Vs(t);throw new I(p.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}var Es=class{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new I(p.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new I(p.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}bE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new I(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new I(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new I(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Rn=class{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Es({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new I(p.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new I(p.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Es(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Wa;switch(r.type){case"firstParty":return new Ya(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new I(p.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=Pf.get(n);r&&(y("ComponentProvider","Removing Datastore"),Pf.delete(n),r.terminate())}(this),Promise.resolve()}};function Pp(t,e,n,r={}){var i;let s=(t=ct(t,Rn))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&_n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=X.MOCK_USER;else{a=ml(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);let u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new I(p.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new X(u)}t._authCredentials=new Ka(new Ji(a,c))}}var $t=class t{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t(this.firestore,e,this._query)}},le=class t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ut(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new t(this.firestore,e,this._key)}},ut=class t extends $t{constructor(e,n,r){super(e,n,Fu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new le(this.firestore,null,new E(e))}withConverter(e){return new t(this.firestore,e,this._path)}};function Cp(t,e,...n){if(t=j(t),Rp("collection","path",e),t instanceof Rn){let r=F.fromString(e,...n);return Df(r),new ut(t,null,r)}{if(!(t instanceof le||t instanceof ut))throw new I(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(F.fromString(e,...n));return Df(r),new ut(t.firestore,null,r)}}function Ku(t,e,...n){if(t=j(t),arguments.length===1&&(e=Xi.newId()),Rp("doc","path",e),t instanceof Rn){let r=F.fromString(e,...n);return Cf(r),new le(t,null,new E(r))}{if(!(t instanceof le||t instanceof ut))throw new I(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(F.fromString(e,...n));return Cf(r),new le(t.firestore,t instanceof ut?t.converter:null,new E(r))}}var vu=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new fs(this,"async_queue_retry"),this.cu=()=>{let n=ja();n&&y("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let e=ja();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;let n=ja();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});let n=new Ne;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){return h(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!Mr(e))throw e;y("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(e){let n=this.nu.then(()=>(this._u=!0,e().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Le("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=n,n}enqueueAfterDelay(e,n,r){this.lu(),this.uu.indexOf(e)>-1&&(n=0);let i=au.createAndSchedule(this,e,n,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&S()}verifyOperationInProgress(){}Tu(){return h(this,null,function*(){let e;do e=this.nu,yield e;while(e!==this.nu)})}Eu(e){for(let n of this.su)if(n.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.su)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){let n=this.su.indexOf(e);this.su.splice(n,1)}};function kf(t){return function(n,r){if(typeof n!="object"||n===null)return!1;let i=n;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}var pt=class extends Rn{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=function(){return new vu}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Np(this),this._firestoreClient.terminate()}};function Dp(t,e){let n=typeof t=="object"?t:Xt(),r=typeof t=="string"?t:e||"(default)",i=Mn(n,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=pl("firestore");s&&Pp(i,...s)}return i}function kp(t){return t._firestoreClient||Np(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Np(t){var e,n,r;let i=t._freezeSettings(),s=function(a,c,u,l){return new ic(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,bp(l.experimentalLongPollingOptions),l.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new Iu(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var Nr=class t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new t(ue.fromBase64String(e))}catch(n){throw new I(p.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new t(ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Pn=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new I(p.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Or=class{constructor(e){this._methodName=e}};var xr=class{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new I(p.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new I(p.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return O(this._lat,e._lat)||O(this._long,e._long)}};var RE=/^__.*__$/,Eu=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Fe(e,this.data,this.fieldMask,n,this.fieldTransforms):new qt(e,this.data,n,this.fieldTransforms)}},ws=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Fe(e,this.data,this.fieldMask,n,this.fieldTransforms)}};function Op(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var wu=class t{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return As(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(e.length===0)throw this.Su("Document fields must not be empty");if(Op(this.Vu)&&RE.test(e))throw this.Su('Document fields cannot begin and end with "__"')}},Tu=class{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Ns(e)}Cu(e,n,r,i=!1){return new wu({Vu:e,methodName:n,Du:r,path:pe.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Hu(t){let e=t._freezeSettings(),n=Ns(t._databaseId);return new Tu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function PE(t,e,n,r,i,s={}){let o=t.Cu(s.merge||s.mergeFields?2:0,e,n,i);Qu("Data must be an object, but it was:",o,r);let a=xp(r,o),c,u;if(s.merge)c=new ye(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let d of s.mergeFields){let f=Au(e,d,n);if(!o.contains(f))throw new I(p.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Lp(l,f)||l.push(f)}c=new ye(l),u=o.fieldTransforms.filter(d=>c.covers(d.field))}else c=null,u=o.fieldTransforms;return new Eu(new fe(a),c,u)}var Ts=class t extends Or{_toFieldTransform(e){if(e.Vu!==2)throw e.Vu===1?e.Su(`${this._methodName}() can only appear at the top level of your update data`):e.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof t}};function CE(t,e,n,r){let i=t.Cu(1,e,n);Qu("Data must be an object, but it was:",i,r);let s=[],o=fe.empty();zt(r,(c,u)=>{let l=Yu(e,c,n);u=j(u);let d=i.yu(l);if(u instanceof Ts)s.push(l);else{let f=Br(u,d);f!=null&&(s.push(l),o.set(l,f))}});let a=new ye(s);return new ws(o,a,i.fieldTransforms)}function DE(t,e,n,r,i,s){let o=t.Cu(1,e,n),a=[Au(e,r,n)],c=[i];if(s.length%2!=0)throw new I(p.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(Au(e,s[f])),c.push(s[f+1]);let u=[],l=fe.empty();for(let f=a.length-1;f>=0;--f)if(!Lp(u,a[f])){let m=a[f],w=c[f];w=j(w);let T=o.yu(m);if(w instanceof Ts)u.push(m);else{let v=Br(w,T);v!=null&&(u.push(m),l.set(m,v))}}let d=new ye(u);return new ws(l,d,o.fieldTransforms)}function kE(t,e,n,r=!1){return Br(n,t.Cu(r?4:3,e))}function Br(t,e){if(Vp(t=j(t)))return Qu("Unsupported field value:",e,t),xp(t,e);if(t instanceof Or)return function(r,i){if(!Op(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.gu&&e.Vu!==4)throw e.Su("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let c=Br(a,i.wu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=j(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return gv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ne.fromDate(r);return{timestampValue:us(i.serializer,s)}}if(r instanceof ne){let s=new ne(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:us(i.serializer,s)}}if(r instanceof xr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nr)return{bytesValue:ip(i.serializer,r._byteString)};if(r instanceof le){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Uu(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${Vs(r)}`)}(t,e)}function xp(t,e){let n={};return Vf(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zt(t,(r,i)=>{let s=Br(i,e.fu(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Vp(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ne||t instanceof xr||t instanceof Nr||t instanceof le||t instanceof Or)}function Qu(t,e,n){if(!Vp(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){let r=Vs(n);throw r==="an object"?e.Su(t+" a custom object"):e.Su(t+" "+r)}}function Au(t,e,n){if((e=j(e))instanceof Pn)return e._internalPath;if(typeof e=="string")return Yu(t,e);throw As("Field path arguments must be of type string or ",t,!1,void 0,n)}var NE=new RegExp("[~\\*/\\[\\]]");function Yu(t,e,n){if(e.search(NE)>=0)throw As(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Pn(...e.split("."))._internalPath}catch{throw As(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function As(t,e,n,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new I(p.INVALID_ARGUMENT,a+t+c)}function Lp(t,e){return t.some(n=>n.isEqual(e))}var Ss=class{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Su(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(Ju("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},Su=class extends Ss{data(){return super.data()}};function Ju(t,e){return typeof e=="string"?Yu(t,e):e instanceof Pn?e._internalPath:e._delegate._internalPath}function OE(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new I(p.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Vr=class{},bs=class extends Vr{};function Mp(t,e,...n){let r=[];e instanceof Vr&&r.push(e),r=r.concat(n),function(s){let o=s.filter(c=>c instanceof Ru).length,a=s.filter(c=>c instanceof bu).length;if(o>1||o>0&&a>0)throw new I(p.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)t=i._apply(t);return t}var bu=class t extends bs{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new t(e,n,r)}_apply(e){let n=this._parse(e);return Up(e._query,n),new $t(e.firestore,e.converter,_c(e._query,n))}_parse(e){let n=Hu(e.firestore);return function(s,o,a,c,u,l,d){let f;if(u.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new I(p.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Of(d,l);let m=[];for(let w of d)m.push(Nf(c,s,w));f={arrayValue:{values:m}}}else f=Nf(c,s,d)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Of(d,l),f=kE(a,o,d,l==="in"||l==="not-in");return K.create(u,l,f)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}};var Ru=class t extends Vr{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new t(e,n)}_parse(e){let n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Te.create(n,this._getOperator())}_apply(e){let n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)Up(o,c),o=_c(o,c)}(e._query,n),new $t(e.firestore,e.converter,_c(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Pu=class t extends bs{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new t(e,n)}_apply(e){let n=function(i,s,o){if(i.startAt!==null)throw new I(p.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new I(p.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ft(s,o)}(e._query,this._field,this._direction);return new $t(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new ht(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}};function Fp(t,e="asc"){let n=e,r=Ju("orderBy",t);return Pu._create(r,n)}function Nf(t,e,n){if(typeof(n=j(n))=="string"){if(n==="")throw new I(p.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zf(e)&&n.indexOf("/")!==-1)throw new I(p.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=e.path.child(F.fromString(n));if(!E.isDocumentKey(r))throw new I(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rf(t,new E(r))}if(n instanceof le)return rf(t,n._key);throw new I(p.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vs(n)}.`)}function Of(t,e){if(!Array.isArray(t)||t.length===0)throw new I(p.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Up(t,e){let n=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new I(p.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new I(p.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}var Cu=class{convertValue(e,n="none"){switch(Mt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return q(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(lt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw S()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){let r={};return zt(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new xr(q(e.latitude),q(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":let r=xu(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Sr(e));default:return null}}convertTimestamp(e){let n=He(e);return new ne(n.seconds,n.nanos)}convertDocumentKey(e,n){let r=F.fromString(e);V(lp(r));let i=new rs(r.get(1),r.get(3)),s=new E(r.popFirst(5));return i.isEqual(n)||Le(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}};function xE(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}var Ot=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Rs=class extends Ss{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new gn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let r=this._document.data.field(Ju("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},gn=class extends Rs{data(e={}){return super.data(e)}},Du=class{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Ot(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new gn(this._firestore,this._userDataWriter,r.key,r,new Ot(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new I(p.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ot(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new gn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Ot(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:VE(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function VE(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}var Ps=class extends Cu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new le(this.firestore,null,n)}};function Bp(t,e,n,...r){t=ct(t,le);let i=ct(t.firestore,pt),s=Hu(i),o;return o=typeof(e=j(e))=="string"||e instanceof Pn?DE(s,"updateDoc",t._key,e,n,r):CE(s,"updateDoc",t._key,e),Zu(i,[o.toMutation(t._key,Ke.exists(!0))])}function qp(t){return Zu(ct(t.firestore,pt),[new Rr(t._key,Ke.none())])}function $p(t,e){let n=ct(t.firestore,pt),r=Ku(t),i=xE(t.converter,e);return Zu(n,[PE(Hu(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Ke.exists(!1))]).then(()=>r)}function Xu(t,...e){var n,r,i;t=j(t);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||kf(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(kf(e[o])){let d=e[o];e[o]=(n=d.next)===null||n===void 0?void 0:n.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let c,u,l;if(t instanceof le)u=ct(t.firestore,pt),l=Fu(t._key.path),c={next:d=>{e[o]&&e[o](LE(u,t,d))},error:e[o+1],complete:e[o+2]};else{let d=ct(t,$t);u=ct(d.firestore,pt),l=d._query;let f=new Ps(u);c={next:m=>{e[o]&&e[o](new Du(u,f,d,m))},error:e[o+1],complete:e[o+2]},OE(t._query)}return function(f,m,w,T){let v=new yu(T),N=new hu(m,v,w);return f.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return oE(yield Rf(f),N)})),()=>{v.Qa(),f.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return aE(yield Rf(f),N)}))}}(kp(u),l,a,c)}function Zu(t,e){return function(r,i){let s=new Ne;return r.asyncQueue.enqueueAndForget(()=>h(this,null,function*(){return mE(yield SE(r),i,s)})),s.promise}(kp(t),e)}function LE(t,e,n){let r=n.docs.get(e._key),i=new Ps(t);return new Rs(t,i,e._key,r,new Ot(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){(function(i){Cn=i})(tt),et(new ge("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new pt(new Ha(r.getProvider("auth-internal")),new Xa(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new I(p.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),H(Zd,"4.6.0",e),H(Zd,"4.6.0","esm2017")})();var Ls=function(){return Ls=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ls.apply(this,arguments)};var UE={includeMetadataChanges:!1};function zp(t,e){return e===void 0&&(e=UE),new Nn(function(n){var r=Xu(t,e,{next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)});return{unsubscribe:r}})}function jp(t,e){var n;e===void 0&&(e={});var r=t.data(e);return!t.exists()||typeof r!="object"||r===null||!e.idField?r:Ls(Ls({},r),(n={},n[e.idField]=t.id,n))}function Gp(t){return zp(t,{includeMetadataChanges:!0}).pipe(Bs(function(e){return e.docs}))}function Wp(t,e){return e===void 0&&(e={}),Gp(t).pipe(Bs(function(n){return n.map(function(r){return jp(r,e)})}))}var qr=class{constructor(e){return e}},Kp="firestore",el=class{constructor(){return Fn(Kp)}};var tl=new Kt("angularfire2.firestore-instances");function BE(t,e){let n=Jr(Kp,t,e);return n&&new qr(n)}function qE(t){return(e,n)=>{let r=e.runOutsideAngular(()=>t(n));return new qr(r)}}var $E={provide:el,deps:[[new me,tl]]},zE={provide:qr,useFactory:BE,deps:[[new me,tl],qe]},jE=(()=>{class t{constructor(){H("angularfire",It.full,"fst")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Ht({type:t});static \u0275inj=Wt({providers:[zE,$E]})}return t})();function AS(t,...e){return{ngModule:jE,providers:[{provide:tl,useFactory:qE(t),multi:!0,deps:[Je,Qt,tn,vt,[new me,Hn],[new me,en],...e]}]}}var SS=Z(Wp,!0);var bS=Z($p,!0);var RS=Z(Cp,!0);var PS=Z(qp,!0);var CS=Z(Ku,!0);var DS=Z(Dp,!0);var kS=Z(Fp,!0);var NS=Z(Mp,!0);var OS=Z(Bp,!0);export{Cw as a,Dw as b,Kn as c,TT as d,AT as e,ST as f,bT as g,RT as h,qr as i,AS as j,SS as k,bS as l,RS as m,PS as n,CS as o,DS as p,kS as q,NS as r,OS as s};
